alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是对 archive_data_wrap_traits.hpp 文件的文档说明：

---

# 文件：archive_data_wrap_traits.hpp

## 简介

该头文件定义了用于归档（archive）数据包装类型特性的模板结构体和相关宏，主要用于确定某种类型在特定归档类型下是否需要特殊的二进制数据包装。此机制便于在序列化/反序列化时对不同类型采用不同的处理方式。

---

## 主要内容

### 1. `binary_data_wrap_traits` 模板结构体

```cpp
template<typename Archive, typename T>
struct binary_data_wrap_traits : public boost::mpl::false_ {
    typedef T wrap_type;
};
```

- **用途**：用于判断类型 `T` 在归档类型 `Archive` 下是否需要二进制包装。
- **默认行为**：继承自 `boost::mpl::false_`，即默认不需要特殊包装。
- **成员类型**：`wrap_type`，默认为 `T` 本身。

---

### 2. 宏定义

#### (1) `YGGR_PP_ARCHIVE_BINARY_DATA_WRAP_TRAITS_DEF`

```cpp
#define YGGR_PP_ARCHIVE_BINARY_DATA_WRAP_TRAITS_DEF( __archive__, __val__, __wrap__ ) \
    namespace yggr { namespace archive { \
    template<> struct binary_data_wrap_traits< __archive__, __val__ > \
        : public boost::mpl::true_ { typedef __wrap__ type; }; }}
```

- **用途**：为特定的归档类型和数据类型定义需要二进制包装，并指定包装类型。
- **参数**：
  - `__archive__`：归档类型
  - `__val__`：原始类型
  - `__wrap__`：包装类型

#### (2) 其它辅助宏

- `YGGR_PP_ARCHIVE_BINARY_DATA_WRAP_TRAITS(__archive__, __val__)`  
  获取指定归档和类型的 traits 类型。

- `YGGR_PP_ARCHIVE_BINARY_DATA_WRAP_TRAITS_WRAP(__archive__, __val__)`  
  获取包装类型（wrap_type）。

- `YGGR_PP_ARCHIVE_NEED_BINARY_DATA_WRAP_TRAITS_T(__archive__, __val__)`  
  获取包装类型（type）。

- `YGGR_PP_ARCHIVE_NEED_BINARY_DATA_WRAP_TRAITS_V(__archive__, __val__)`  
  获取是否需要包装的布尔值（value）。

---

## 命名空间

- `yggr::archive`  
  所有类型和宏均定义在该命名空间下。

---

## 典型用法

1. **自定义类型包装特化：**

```cpp
YGGR_PP_ARCHIVE_BINARY_DATA_WRAP_TRAITS_DEF(MyArchive, MyType, MyTypeWrap)
```
此宏会为 `MyArchive` 和 `MyType` 生成特化版本，表明 `MyType` 需要包装为 `MyTypeWrap`。

2. **判断是否需要包装：**

```cpp
bool need_wrap = YGGR_PP_ARCHIVE_NEED_BINARY_DATA_WRAP_TRAITS_V(MyArchive, MyType);
```

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

如需进一步了解用法，请参考相关归档和序列化实现。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 archive_inner_keys.hpp 文件的文档说明：

---

# 文件：archive_inner_keys.hpp

## 简介

该头文件用于定义归档（archive）内部关键字的类型安全访问方式。通过一系列宏和模板，提供了跨多种字符类型（如 char、wchar_t、char8_t、char16_t、char32_t）和字符串类型的关键字常量表达，并支持类型安全的转换和获取。这些关键字主要用于序列化/反序列化过程中标识 Boost Archive 相关的内部字段。

---

## 主要内容

### 1. 关键字类型转换宏

根据编译环境支持的字符类型，定义了将关键字转换为不同指针类型的操作符重载宏：

- `YGGR_ARCHIVE_INNER_KEYS_OPERATOR_POINTER_WCHAR_T()`
- `YGGR_ARCHIVE_INNER_KEYS_OPERATOR_POINTER_CHAR8()`
- `YGGR_ARCHIVE_INNER_KEYS_OPERATOR_POINTER_CHAR16()`
- `YGGR_ARCHIVE_INNER_KEYS_OPERATOR_POINTER_CHAR32()`

这些宏分别为关键字结构体添加了向 `wchar_t*`、`char8_t*`、`char16_t*`、`char32_t*` 的类型转换操作符。

---

### 2. 关键字定义宏

#### `YGGR_ARCHIVE_INNER_KEYS_DEF(__key__)`

该宏会自动生成一个结构体和一个获取函数，用于类型安全地访问关键字常量。结构体支持多种字符类型和字符串类型的转换。

- **结构体**：`archive_inner_keys_<__key__>`
  - 支持向 `char*` 及多种字符串类型的隐式转换。
- **获取函数**：`inner_key_<__key__>()`
  - 根据模板参数类型，返回 const 指针或 const 引用，保证类型安全。

#### 典型用法

```cpp
YGGR_ARCHIVE_INNER_KEYS_DEF(boost_ar_obj_id)
```
会生成 `archive_inner_keys_boost_ar_obj_id` 结构体和 `inner_key_boost_ar_obj_id<T>()` 函数。

---

### 3. 预定义的归档内部关键字

通过宏定义，预设了以下 Boost Archive 相关关键字：

- `boost_ar_obj_id`
- `boost_ar_obj_id_ref`
- `boost_ar_ver`
- `boost_ar_library_ver`
- `boost_ar_class_id`
- `boost_ar_class_id_ref`
- `boost_ar_class_name`
- `boost_ar_tracking`

---

### 4. 辅助宏

- `YGGR_ARCHIVE_GET_INNER_KEY(__type__, __key__)`  
  获取指定类型和关键字的类型安全常量。

---

## 命名空间

- 主要内容位于 `yggr::archive` 命名空间下。

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为归档内部关键字的类型安全访问提供了统一的接口，支持多字符集和多字符串类型，便于跨平台和多语言环境下的序列化开发。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 archive_partner_template.hpp 文件的文档说明：

---

# 文件：archive_partner_template.hpp

## 简介

该头文件定义了归档伙伴（archive partner）相关的模板类和宏，用于描述和管理不同归档类型（如网络、XML、文本、二进制、SQL、BSON等）的支持特性。通过模板和静态常量，便于统一管理归档类型的能力检测和元信息获取。

---

## 主要内容

### 1. `archive_partner_t` 结构体

```cpp
struct archive_partner_t
{
    YGGR_STATIC_CONSTANT(u32, E_Mode_Start = 0x00000000);
    YGGR_STATIC_CONSTANT(u32, E_Mode_Network = 0x00000001);
    YGGR_STATIC_CONSTANT(u32, E_Mode_XML = 0x00000002);
    YGGR_STATIC_CONSTANT(u32, E_Mode_Text = 0x00000004);
    YGGR_STATIC_CONSTANT(u32, E_Mode_Binary = 0x00000008);
    YGGR_STATIC_CONSTANT(u32, E_Mode_Sql = 0x00000010); // 目前未支持
    YGGR_STATIC_CONSTANT(u32, E_Mode_Bson = 0x00000020);
    YGGR_STATIC_CONSTANT(u32, E_Mode_End = 0xffffffff);
};
```

- **用途**：定义各种归档模式的标志位（以位掩码方式），用于后续归档类型的能力描述。

---

### 2. 归档伙伴模板宏

#### `YGGR_PP_ARCHIVE_PARTENER_TEMPLATE_DECL`

```cpp
#define YGGR_PP_ARCHIVE_PARTENER_TEMPLATE_DECL(__name__, Archive, Archive_Helper, Mode) \
    class __name__ : private nonable::noncreateable { ... }
```

- **用途**：快速声明一个归档伙伴类型，指定归档类型、辅助类型和支持的模式。
- **成员**：
  - `archive_type`、`archive_helper_type` 类型别名
  - 静态常量 `E_Mode`
  - 一系列静态成员函数用于检测是否支持某种归档模式（如 `is_support_network()` 等）
  - `mode()` 返回支持的模式

---

### 3. `archive_partner_template` 模板类

```cpp
template<typename Archive, typename Archive_Helper, u32 Mode>
class archive_partner_template : private nonable::noncreateable
{
    // 类型别名
    // 静态常量 E_Mode
    // 支持检测函数
    // mode() 获取模式
};
```

- **用途**：通用的归档伙伴模板，便于通过模板参数自定义归档类型、辅助类型和支持的模式。
- **成员函数**：
  - `is_support_network()`：是否支持网络归档
  - `is_support_xml_file()`：是否支持 XML 文件归档
  - `is_support_text_file()`：是否支持文本文件归档
  - `is_support_binary_file()`：是否支持二进制文件归档
  - `is_support_sql()`：是否支持 SQL 归档
  - `is_support_bson()`：是否支持 BSON 归档
  - `mode()`：返回当前支持的模式

- **特性**：继承自 `nonable::noncreateable`，禁止实例化，仅用于静态接口和类型信息。

---

## 命名空间

- 所有内容位于 `yggr::archive::archive_partner` 命名空间下。

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为归档类型的能力描述和统一管理提供了模板化、类型安全的基础设施，便于扩展和维护多种归档格式的支持能力。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 basic_bson_iarchive.hpp 文件的文档说明：

---

# 文件：basic_bson_iarchive.hpp

## 简介

该头文件定义了 BSON 格式反序列化归档的基础模板类 `basic_bson_iarchive`，用于从 BSON 数据流中读取和还原对象。该类集成了 Boost.Serialization 框架，支持对 Boost 内部归档类型（如对象ID、版本、类名等）的读取，并提供了对自定义类型的扩展支持。

---

## 主要内容

### 1. 类模板 `basic_bson_iarchive`

```cpp
template<typename Archive>
class basic_bson_iarchive : public boost::archive::detail::common_iarchive<Archive>
{
    // 主要成员与方法见下文
};
```

#### 主要类型定义

- `archive_type`：归档类型模板参数
- `base_type`：基类，Boost 的通用输入归档
- `buf_type`：BSON 缓冲区类型（`nsql_database_system::c_bson`）
- `proxy_type`：BSON 访问代理
- `buf_citer_type`：BSON 缓冲区常量迭代器
- `buf_inner_string_type`：BSON 内部字符串类型

#### 主要成员变量

- `_start`：当前读取位置的迭代器
- `_end`：缓冲区结束迭代器

#### 构造与析构

- `basic_bson_iarchive(const buf_type& buf, unsigned int flags)`  
  构造函数，初始化读取区间，并根据归档类型是否跳过自动ID进行调整。
- `~basic_bson_iarchive()`  
  析构函数。

#### 主要成员函数

- `load_override`  
  重载函数，支持 Boost 内部类型（如 object_id_type、version_type、class_id_type、class_name_type、tracking_type 等）的读取。
- `load_begin` / `load_end`  
  用于序列化流程中对象的开始与结束标记处理，支持多种字符串类型。
- `skip_override`  
  跳过特定类型的读取（如 class_id_type）。
- `prv_load_override`  
  内部辅助函数，根据类型特性选择不同的反序列化策略。
- 模板重载 `load_override`  
  支持自定义类型的反序列化，要求类型满足 BSON 拼接特性（`is_bson_splice_t`）。

---

## 典型用法

该类通常作为 BSON 输入归档的基础，被具体归档类继承，用于实现自定义对象的反序列化。例如：

```cpp
// 伪代码
nsql_database_system::c_bson bson_data = ...;
my_bson_iarchive ar(bson_data, flags);
ar >> my_object;
```

---

## 依赖与扩展

- 依赖 Boost.Serialization 框架
- 依赖 Yggdrasil 的 BSON 数据结构与访问代理
- 支持对 Boost 内部归档类型的自动处理
- 可扩展支持自定义类型的 BSON 反序列化

---

## 命名空间

- 所有内容位于 `yggr::archive` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 BSON 格式的反序列化提供了基础设施，兼容 Boost.Serialization，适用于需要将 BSON 数据还原为 C++ 对象的场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 basic_bson_oarchive.hpp 文件的文档说明：

---

# 文件：basic_bson_oarchive.hpp

## 简介

该头文件定义了 BSON 格式序列化归档的基础模板类 `basic_bson_oarchive`，用于将 C++ 对象序列化为 BSON 数据。该类集成了 Boost.Serialization 框架，支持对 Boost 内部归档类型（如对象ID、版本、类名等）的写入，并提供了对自定义类型的扩展支持。

---

## 主要内容

### 1. 类模板 `basic_bson_oarchive`

```cpp
template<typename Archive>
class basic_bson_oarchive : public boost::archive::detail::common_oarchive<Archive>
{
    // 主要成员与方法见下文
};
```

#### 主要类型定义

- `archive_type`：归档类型模板参数
- `base_type`：基类，Boost 的通用输出归档
- `buf_type`：BSON 缓冲区类型（`nsql_database_system::c_bson`）
- `proxy_type`：BSON 访问代理
- `buf_inner_string_type`：BSON 内部字符串类型

#### 主要成员变量

- `_buf`：BSON 缓冲区的引用，用于存储序列化结果

#### 构造与析构

- `basic_bson_oarchive(buf_type& buf, unsigned int flags)`  
  构造函数，初始化缓冲区和归档标志。
- `~basic_bson_oarchive()`  
  析构函数。

#### 主要成员函数

- `save_override`  
  重载函数，支持 Boost 内部类型（如 object_id_type、version_type、class_id_type、class_name_type、tracking_type 等）的写入。
- `save_begin` / `save_end`  
  用于序列化流程中对象的开始与结束标记处理，支持多种字符串类型。
- 模板重载 `save_override`  
  支持自定义类型的序列化，要求类型满足 BSON 拼接特性（`is_bson_splice_t`）。
- `prv_save_override`  
  内部辅助函数，根据类型特性选择不同的序列化策略（区分内部类型和非内部类型）。

---

## 典型用法

该类通常作为 BSON 输出归档的基础，被具体归档类继承，用于实现自定义对象的序列化。例如：

```cpp
// 伪代码
nsql_database_system::c_bson bson_data;
my_bson_oarchive ar(bson_data, flags);
ar << my_object;
```

---

## 依赖与扩展

- 依赖 Boost.Serialization 框架
- 依赖 Yggdrasil 的 BSON 数据结构与访问代理
- 支持对 Boost 内部归档类型的自动处理
- 可扩展支持自定义类型的 BSON 序列化

---

## 命名空间

- 所有内容位于 `yggr::archive` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 BSON 格式的序列化提供了基础设施，兼容 Boost.Serialization，适用于需要将 C++ 对象保存为 BSON 数据的场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 binary_archive_partner.hpp 文件的文档说明：

---

# 文件：binary_archive_partner.hpp

## 简介

该头文件定义了 Yggdrasil 框架下二进制归档相关的“归档伙伴”类型（archive partner），用于描述和管理二进制输入/输出归档的能力与辅助工具。通过宏或模板，统一了二进制归档类型的元信息和能力检测接口，便于归档系统的扩展和维护。

---

## 主要内容

### 1. 依赖

- `archive_partner_template.hpp`：归档伙伴模板基础设施
- `string_archive_helper.hpp`：字符串归档辅助工具
- `binary_iarchive.hpp` / `binary_oarchive.hpp`：二进制输入/输出归档
- `binary_wiarchive.hpp` / `binary_woarchive.hpp`：宽字符二进制输入/输出归档

---

### 2. 归档伙伴类型定义

根据是否定义 `YGGR_TPL_CONFIG_USING_TPL`，有两种实现方式：

#### 宏方式（默认）

使用 `YGGR_PP_ARCHIVE_PARTENER_TEMPLATE_DECL` 宏快速声明以下四种归档伙伴类型：

- `binary_iarchive_partner`：二进制输入归档伙伴
- `binary_oarchive_partner`：二进制输出归档伙伴
- `binary_wiarchive_partner`：宽字符二进制输入归档伙伴
- `binary_woarchive_partner`：宽字符二进制输出归档伙伴

每个类型都指定了归档类型、辅助类型和支持的模式（`E_Mode_Binary`）。

#### 模板方式

直接用 `archive_partner_template` 模板定义上述四种类型，功能等价。

---

### 3. 主要用途

这些归档伙伴类型用于：

- 统一描述归档类型的能力（如是否支持二进制模式）
- 提供归档类型与辅助工具的类型信息
- 便于归档系统根据类型特性自动选择合适的归档实现

---

## 命名空间

- 所有内容位于 `yggr::archive::archive_partner` 命名空间下。

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的二进制归档类型提供了统一的“伙伴”类型定义，是归档系统类型安全和能力检测的重要基础设施。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 binary_iarchive_impl.hpp 文件的文档说明：

---

# 文件：binary_iarchive_impl.hpp

## 简介

该头文件定义了 Yggdrasil 框架下二进制输入归档的实现模板类 `binary_iarchive_impl`，用于从二进制流中反序列化（读取）各种类型的数据，特别是对多种字符串类型和集合大小类型的高效支持。该类集成并扩展了 Boost.Serialization 的二进制归档机制，适配多字符集和多平台环境。

---

## 主要内容

### 1. 类模板 `binary_iarchive_impl`

```cpp
template<typename Archive, typename Elem, typename Tr>
class binary_iarchive_impl
    : public boost::archive::basic_binary_iprimitive<Archive, Elem, Tr>,
      public boost::archive::basic_binary_iarchive<Archive>
{
    // 主要成员与方法见下文
};
```

#### 主要类型定义

- `base_type`：Boost 的二进制输入原语基类
- `base2_type`：Boost 的二进制输入归档基类

#### 构造与初始化

- 支持通过 `std::basic_streambuf` 或 `std::basic_istream` 构造，自动初始化归档状态。

#### 主要成员函数

- `load_override`  
  重载，支持对任意类型的反序列化，委托给基类处理。

- `init`  
  初始化归档，处理归档头部信息。

- `load`  
  针对不同字符串类型（如 `std::basic_string`、`boost::container::basic_string`、`char*`、`wchar_t*`、`c8*`、`c16*`、`c32*` 等）和集合大小类型（如 `boost::serialization::collection_size_type`）的专门反序列化实现。  
  - 对于单字节字符类型，直接读取长度和内容。
  - 对于多字节字符类型，按字符宽度读取内容。
  - 自动处理字符串结尾的空字符。

- `pro_load_string_char_1` / `pro_load_string_char_n`  
  内部辅助函数，分别处理单字节和多字节字符的字符串反序列化。

---

## 特性与适配

- 支持多种字符集（char、wchar_t、char8_t、char16_t、char32_t）
- 支持标准库和 Boost.Container 的字符串类型
- 针对不同平台和编译器做了兼容性处理
- 适配 Boost.Serialization 的归档机制，支持集合大小类型的反序列化

---

## 命名空间

- 所有内容位于 `yggr::archive` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的二进制输入归档提供了高效、类型安全的反序列化实现，兼容 Boost.Serialization，适用于多字符集和多平台的二进制数据读取场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 binary_iarchive.hpp 文件的文档说明：

---

# 文件：binary_iarchive.hpp

## 简介

该头文件定义了 Yggdrasil 框架下的二进制输入归档类 `binary_iarchive` 及其裸归档版本 `naked_binary_iarchive`，用于从二进制流中反序列化（读取）C++ 对象。该类基于 Boost.Serialization 的归档机制，并针对 shared_ptr 及 Boost 版本做了兼容性处理，支持类型注册和序列化优化。

---

## 主要内容

### 1. 依赖

- `binary_iarchive_impl.hpp`：二进制输入归档实现模板
- `archive_data_wrap_traits.hpp`：归档数据包装特性
- Boost.Serialization 相关头文件

---

### 2. 类定义

#### `naked_binary_iarchive`

```cpp
class naked_binary_iarchive 
    : public binary_iarchive_impl<yggr::archive::naked_binary_iarchive, std::istream::char_type, std::istream::traits_type>
{
public:
    naked_binary_iarchive(std::istream & is, unsigned int flags = 0);
    naked_binary_iarchive(std::streambuf & bsb, unsigned int flags = 0);
};
```

- **用途**：标准二进制输入归档，不包含 shared_ptr 辅助功能。
- **构造**：支持通过输入流或流缓冲区构造。

#### `binary_iarchive`

```cpp
class binary_iarchive 
    : public binary_iarchive_impl<yggr::archive::binary_iarchive, std::istream::char_type, std::istream::traits_type>
#if BOOST_VERSION < 105600
    , public boost::archive::detail::shared_ptr_helper
#endif
{
public:
    binary_iarchive(std::istream & is, unsigned int flags = 0);
    binary_iarchive(std::streambuf & bsb, unsigned int flags = 0);
};
```

- **用途**：标准二进制输入归档，兼容 Boost 1.56.0 之前版本时自动包含 shared_ptr 辅助功能。
- **构造**：支持通过输入流或流缓冲区构造。

---

### 3. 类型注册与序列化优化

- `BOOST_SERIALIZATION_REGISTER_ARCHIVE(yggr::archive::binary_iarchive)`  
  注册归档类型，便于 Boost.Serialization 导出机制识别。
- `BOOST_SERIALIZATION_USE_ARRAY_OPTIMIZATION(yggr::archive::binary_iarchive)`  
  启用数组序列化优化，提高性能。

---

### 4. 兼容性与补丁

- 针对 Boost 1.56.0 之前版本，自动继承 `shared_ptr_helper`，以支持 shared_ptr 的特殊序列化需求。
- 包含 `iserializer_patch.hpp`，对 Boost 的非指针类型序列化做补丁处理，并通过宏自动应用到本归档类型。

---

## 命名空间

- 主要内容位于 `yggr::archive` 命名空间下
- 类型注册相关内容位于 `boost` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的二进制输入归档提供了标准实现，兼容 Boost.Serialization，支持类型注册、数组优化和 shared_ptr 特性，适用于高效的二进制反序列化场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 binary_oarchive_impl.hpp 文件的文档说明：

---

# 文件：binary_oarchive_impl.hpp

## 简介

该头文件定义了 Yggdrasil 框架下二进制输出归档的实现模板类 `binary_oarchive_impl`，用于将各种类型的数据（尤其是多种字符串类型和集合大小类型）高效地序列化（写入）到二进制流中。该类集成并扩展了 Boost.Serialization 的二进制归档机制，适配多字符集和多平台环境。

---

## 主要内容

### 1. 类模板 `binary_oarchive_impl`

```cpp
template<typename Archive, typename Elem, typename Tr>
class binary_oarchive_impl
    : public boost::archive::basic_binary_oprimitive<Archive, Elem, Tr>,
      public boost::archive::basic_binary_oarchive<Archive>
{
    // 主要成员与方法见下文
};
```

#### 主要类型定义

- `base_type`：Boost 的二进制输出原语基类
- 继承自 Boost 的二进制输出归档基类

#### 构造与初始化

- 支持通过 `std::basic_streambuf` 或 `std::basic_ostream` 构造，自动初始化归档状态。
- `init` 方法根据归档标志初始化归档头部信息。

#### 主要成员函数

- `save_override`  
  模板重载，支持对任意类型的序列化，委托给基类处理。

- `save`  
  针对不同字符串类型（如 `std::basic_string`、`boost::container::basic_string`、`char*`、`wchar_t*`、`c8*`、`c16*`、`c32*` 等）和集合大小类型（如 `boost::serialization::collection_size_type`、`yggr::serialization::collection_size_type`）的专门序列化实现。  
  - 对于单字节字符类型，直接写入长度和内容。
  - 对于多字节字符类型，按字符宽度写入内容。
  - 自动处理字符串结尾的空字符。

- `pro_save_string_char_1` / `pro_save_string_char_n`  
  内部辅助函数，分别处理单字节和多字节字符的字符串序列化。

---

## 特性与适配

- 支持多种字符集（char、wchar_t、char8_t、char16_t、char32_t）
- 支持标准库和 Boost.Container 的字符串类型
- 针对不同平台和编译器做了兼容性处理
- 适配 Boost.Serialization 的归档机制，支持集合大小类型的序列化

---

## 命名空间

- 所有内容位于 `yggr::archive` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的二进制输出归档提供了高效、类型安全的序列化实现，兼容 Boost.Serialization，适用于多字符集和多平台的二进制数据写入场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 binary_oarchive.hpp 文件的文档说明：

---

# 文件：binary_oarchive.hpp

## 简介

该头文件定义了 Yggdrasil 框架下的二进制输出归档类 `binary_oarchive`，用于将 C++ 对象序列化（写入）到二进制流中。该类基于 Boost.Serialization 的归档机制，支持类型注册、数组优化，并对 Boost 的序列化器做了补丁处理，适用于高效的二进制数据写入场景。

---

## 主要内容

### 1. 依赖

- `binary_oarchive_impl.hpp`：二进制输出归档实现模板
- `archive_data_wrap_traits.hpp`：归档数据包装特性
- Boost.Serialization 相关头文件

---

### 2. 类定义

#### `binary_oarchive`

```cpp
class binary_oarchive 
    : public binary_oarchive_impl<
            binary_oarchive, 
            std::ostream::char_type,
            std::ostream::traits_type
        >
{
public:
    typedef std::ostream::char_type char_type;
    typedef std::ostream::traits_type traits_type;
    typedef binary_oarchive_impl<
            binary_oarchive, 
            std::ostream::char_type,
            std::ostream::traits_type
        > base_type;

    binary_oarchive(std::ostream & os, unsigned int flags = 0)
        : base_type(os, flags) {}

    binary_oarchive(std::streambuf & bsb, unsigned int flags = 0)
        : base_type(bsb, flags) {}
};
```

- **用途**：标准二进制输出归档，支持通过输出流或流缓冲区构造。
- **继承**：基于 `binary_oarchive_impl` 实现，建议如需扩展请继承自实现类而非本类，以保证静态多态性。
- **别名**：`typedef binary_oarchive naked_binary_oarchive;`  
  裸归档类型，功能等同于 `binary_oarchive`。

---

### 3. 类型注册与序列化优化

- `BOOST_SERIALIZATION_REGISTER_ARCHIVE(yggr::archive::binary_oarchive)`  
  注册归档类型，便于 Boost.Serialization 导出机制识别。
- `BOOST_SERIALIZATION_USE_ARRAY_OPTIMIZATION(yggr::archive::binary_oarchive)`  
  启用数组序列化优化，提高性能。

---

### 4. 兼容性与补丁

- 包含 `oserializer_patch.hpp`，对 Boost 的非指针类型序列化做补丁处理，并通过宏自动应用到本归档类型。

---

## 命名空间

- 主要内容位于 `yggr::archive` 命名空间下
- 类型注册相关内容位于 `boost` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的二进制输出归档提供了标准实现，兼容 Boost.Serialization，支持类型注册、数组优化和序列化补丁，适用于高效的二进制序列化场景。

找到具有 1 个许可证类型的类似代码

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 binary_wiarchive.hpp 文件的文档说明：

---

# 文件：binary_wiarchive.hpp

## 简介

该头文件定义了 Yggdrasil 框架下的宽字符二进制输入归档类 `binary_wiarchive` 及其裸归档版本 `naked_binary_wiarchive`，用于从宽字符二进制流（如 `std::wistream`）中反序列化（读取）C++ 对象。该类基于 Boost.Serialization 的归档机制，支持类型注册、宽字符流兼容和序列化补丁，适用于宽字符环境下的高效二进制反序列化。

---

## 主要内容

### 1. 依赖

- `binary_iarchive_impl.hpp`：二进制输入归档实现模板
- `archive_data_wrap_traits.hpp`：归档数据包装特性
- `impl/codecvt_null.hpp`、`impl/utf8_codecvt_facet.hpp`：字符集转换支持
- Boost.Serialization 相关头文件

---

### 2. 类定义

#### `naked_binary_wiarchive`

```cpp
class naked_binary_wiarchive 
    : public binary_iarchive_impl<
            yggr::archive::naked_binary_wiarchive, 
            std::wistream::char_type, 
            std::wistream::traits_type
        >
{
public:
    naked_binary_wiarchive(std::wistream & is, unsigned int flags = 0);
    naked_binary_wiarchive(std::wstreambuf & bsb, unsigned int flags = 0);
};
```

- **用途**：标准宽字符二进制输入归档，不包含 shared_ptr 辅助功能。
- **构造**：支持通过宽字符输入流或流缓冲区构造。

#### `binary_wiarchive`

```cpp
class binary_wiarchive 
    : public binary_iarchive_impl<
            yggr::archive::binary_wiarchive,
            std::wistream::char_type, 
            std::wistream::traits_type
        >
{
public:
    binary_wiarchive(std::wistream & is, unsigned int flags = 0);
    binary_wiarchive(std::wstreambuf & bsb, unsigned int flags = 0);
};
```

- **用途**：标准宽字符二进制输入归档，支持通过宽字符输入流或流缓冲区构造。

---

### 3. 类型注册与序列化补丁

- `BOOST_SERIALIZATION_REGISTER_ARCHIVE(yggr::archive::binary_wiarchive)`  
  注册归档类型，便于 Boost.Serialization 导出机制识别。
- 包含 `iserializer_patch.hpp`，对 Boost 的非指针类型序列化做补丁处理，并通过宏自动应用到本归档类型及裸归档类型。

---

### 4. 兼容性

- 若平台不支持宽字符流（`BOOST_NO_STD_WSTREAMBUF`），则编译时报错。
- 针对 Boost 1.56.0 之前版本，自动包含 `shared_ptr_helper`，以支持 shared_ptr 的特殊序列化需求。

---

## 命名空间

- 主要内容位于 `yggr::archive` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的宽字符二进制输入归档提供了标准实现，兼容 Boost.Serialization，支持类型注册、宽字符流和序列化补丁，适用于宽字符环境下的高效二进制反序列化场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 binary_woarchive.hpp 文件的文档说明：

---

# 文件：binary_woarchive.hpp

## 简介

该头文件定义了 Yggdrasil 框架下的宽字符二进制输出归档类 `binary_woarchive` 及其裸归档版本 `naked_binary_woarchive`，用于将 C++ 对象以宽字符格式序列化（写入）到二进制流（如 `std::wostream`）中。该类基于 Boost.Serialization 的归档机制，支持类型注册、宽字符流兼容和序列化补丁，适用于宽字符环境下的高效二进制序列化。

---

## 主要内容

### 1. 依赖

- `binary_oarchive_impl.hpp`：二进制输出归档实现模板
- `archive_data_wrap_traits.hpp`：归档数据包装特性
- `impl/codecvt_null.hpp`、`impl/utf8_codecvt_facet.hpp`：字符集转换支持
- Boost.Serialization 相关头文件

---

### 2. 类定义

#### `binary_woarchive`

```cpp
class binary_woarchive
    : public binary_oarchive_impl<
            yggr::archive::binary_woarchive,
            std::wostream::char_type,
            std::wostream::traits_type
        >
{
public:
    typedef std::wostream::char_type char_type;
    typedef std::wostream::traits_type traits_type;
    typedef binary_oarchive_impl<
            yggr::archive::binary_woarchive,
            std::wostream::char_type,
            std::wostream::traits_type
        > base_type;

    binary_woarchive(std::wostream & os, unsigned int flags = 0)
        : base_type(os, flags) {}

    binary_woarchive(std::wstreambuf & bsb, unsigned int flags = 0)
        : base_type(bsb, flags) {}
};
```

- **用途**：标准宽字符二进制输出归档，支持通过宽字符输出流或流缓冲区构造。
- **别名**：`typedef binary_woarchive naked_binary_woarchive;`  
  裸归档类型，功能等同于 `binary_woarchive`。

---

### 3. 类型注册与序列化补丁

- `BOOST_SERIALIZATION_REGISTER_ARCHIVE(yggr::archive::binary_woarchive)`  
  注册归档类型，便于 Boost.Serialization 导出机制识别。
- 包含 `oserializer_patch.hpp`，对 Boost 的非指针类型序列化做补丁处理，并通过宏自动应用到本归档类型。

---

### 4. 兼容性

- 若平台不支持宽字符流（`BOOST_NO_STD_WSTREAMBUF`），则编译时报错。

---

## 命名空间

- 主要内容位于 `yggr::archive` 命名空间下
- 类型注册相关内容位于 `boost` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的宽字符二进制输出归档提供了标准实现，兼容 Boost.Serialization，支持类型注册、宽字符流和序列化补丁，适用于宽字符环境下的高效二进制序列化场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 bson_archive_helper.hpp 文件的文档说明：

---

# 文件：bson_archive_helper.hpp

## 简介

该头文件定义了 Yggdrasil 框架下 BSON 归档辅助工具类 `bson_archive_helper`，用于简化 BSON 数据缓冲区的管理、对象的序列化与反序列化操作。该类为 BSON 归档提供了统一的缓冲区操作接口和异常安全的序列化流程，适用于基于 BSON 的数据交换和存储场景。

---

## 主要内容

### 1. 模板类 `bson_archive_helper`

```cpp
template<typename Archive>
class bson_archive_helper
{
    // 主要成员与方法见下文
};
```

#### 主要类型定义

- `archive_type`：归档类型模板参数
- `buf_type`：BSON 缓冲区类型（`nsql_database_system::c_bson`）
- `output_stream_type` / `input_stream_type`：输出/输入流类型，均为 BSON 缓冲区

---

#### 主要缓冲区操作

- **拷贝与移动**
  - `buf_copy(buf1, buf2)`：支持右值引用和常量引用的缓冲区拷贝/移动，自动避免自拷贝。
- **交换**
  - `buf_swap(buf1, buf2)`：交换两个缓冲区内容，自动避免自交换。
- **大小与状态**
  - `buf_size(buf)`：获取缓冲区大小
  - `buf_empty(buf)`：判断缓冲区是否为空
  - `buf_clear(buf)`：清空缓冲区
  - `buf_init(buf)`：初始化缓冲区
- **指针与比较**
  - `buf_real_val_ptr(buf)`：获取缓冲区真实值指针
  - `buf_val_ptr(buf)`：获取缓冲区值指针
  - `buf_compare(buf1, buf2)`：比较两个缓冲区内容是否相等

---

#### 缓冲区赋值

- `buf_assign(buf, args...)`：支持变参模板（C++11）或宏展开（C++03），将参数赋值到缓冲区。

---

#### 序列化与反序列化

- `save(const Object& obj, buf_type& buf)`  
  将对象序列化为 BSON 缓冲区，异常安全，支持 Boost 异常和系统异常处理。
- `load(boost::serialization::nvp<Object>& nvp, buf_type& buf)`  
  从 BSON 缓冲区反序列化带名字值对的对象，异常安全。
- `load(Object& obj, buf_type& buf)`  
  从 BSON 缓冲区反序列化对象，异常安全。

---

## 典型用法

```cpp
nsql_database_system::c_bson buf;
MyObject obj;

// 序列化
yggr::archive::archive_helper::bson_archive_helper<MyArchive>::save(obj, buf);

// 反序列化
yggr::archive::archive_helper::bson_archive_helper<MyArchive>::load(obj, buf);
```

---

## 设计特点

- 统一的缓冲区操作接口，便于归档代码复用
- 支持 C++11 变参模板和 C++03 宏展开
- 异常安全，自动处理 Boost 和系统异常
- 适配 Yggdrasil 的 BSON 数据结构

---

## 命名空间

- 所有内容位于 `yggr::archive::archive_helper` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的 BSON 归档提供了高效、类型安全的辅助工具，简化了缓冲区管理和对象序列化流程，适用于各种基于 BSON 的数据处理场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 bson_archive_partner.hpp 文件的文档说明：

---

# 文件：bson_archive_partner.hpp

## 简介

该头文件定义了 Yggdrasil 框架下 BSON 归档相关的“归档伙伴”类型（archive partner），用于描述和管理多种 BSON 输入/输出归档的能力与辅助工具。通过宏或模板，统一了 BSON 归档类型的元信息和能力检测接口，便于归档系统的扩展和维护。

---

## 主要内容

### 1. 依赖

- `archive_partner_template.hpp`：归档伙伴模板基础设施
- `bson_archive_helper.hpp`：BSON 归档辅助工具
- `bson_iarchive.hpp` / `bson_oarchive.hpp`：BSON 输入/输出归档

---

### 2. 归档伙伴类型定义

根据是否定义 `YGGR_TPL_CONFIG_USING_TPL`，有两种实现方式：

#### 宏方式（默认）

使用 `YGGR_PP_ARCHIVE_PARTENER_TEMPLATE_DECL` 宏快速声明以下四种 BSON 归档伙伴类型：

- `bson_iarchive_partner`  
  - 归档类型：`archive::bson_iarchive<true>`
  - 辅助类型：`archive_helper::bson_archive_helper<archive::bson_iarchive<true>>`
  - 支持模式：`E_Mode_Bson`
- `bson_conv_iarchive_partner`  
  - 归档类型：`archive::bson_iarchive<false>`
  - 辅助类型：`archive_helper::bson_archive_helper<archive::bson_iarchive<false>>`
  - 支持模式：`E_Mode_Bson`
- `bson_oarchive_partner`  
  - 归档类型：`archive::bson_oarchive<false>`
  - 辅助类型：`archive_helper::bson_archive_helper<archive::bson_oarchive<false>>`
  - 支持模式：`E_Mode_Bson`
- `bson_nld_oarchive_partner`  
  - 归档类型：`archive::bson_oarchive<true>`
  - 辅助类型：`archive_helper::bson_archive_helper<archive::bson_oarchive<true>>`
  - 支持模式：`E_Mode_Bson`

#### 模板方式

直接用 `archive_partner_template` 模板定义上述四种类型，功能等价。

---

### 3. 别名定义

- `bson_io_iarchive_partner`：等同于 `bson_iarchive_partner`
- `bson_io_oarchive_partner`：等同于 `bson_oarchive_partner`
- `bson_conv_oarchive_partner`：等同于 `bson_oarchive_partner`

---

### 4. 主要用途

这些归档伙伴类型用于：

- 统一描述 BSON 归档类型的能力（如是否支持 BSON 模式）
- 提供归档类型与辅助工具的类型信息
- 便于归档系统根据类型特性自动选择合适的归档实现

---

## 命名空间

- 所有内容位于 `yggr::archive::archive_partner` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的 BSON 归档类型提供了统一的“伙伴”类型定义，是归档系统类型安全和能力检测的重要基础设施，便于 BSON 数据的序列化与反序列化扩展。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 bson_iarchive.hpp 文件的文档说明：

---

# 文件：bson_iarchive.hpp

## 简介

该头文件定义了 Yggdrasil 框架下的 BSON 输入归档类 `bson_iarchive` 及其实现，支持从 BSON 数据缓冲区反序列化（读取）C++ 对象。该类基于 Boost.Serialization 归档机制，支持自动 ID 跳过、shared_ptr 辅助、类型注册、二进制数据包装和序列化补丁，适用于 BSON 格式数据的高效反序列化。

---

## 主要内容

### 1. 依赖

- `basic_bson_iarchive.hpp`：BSON 输入归档基础实现
- Boost.Serialization 相关头文件
- Yggdrasil 的 BSON 数据结构与辅助工具
- 归档数据包装 traits、序列化补丁等

---

### 2. 归档实现模板

#### `bson_iarchive_impl`

```cpp
template<class Archive>
class bson_iarchive_impl : public basic_bson_iarchive<Archive>
{
    // 主要成员与方法见下文
};
```

- **用途**：为 BSON 输入归档提供底层实现，支持各种类型的反序列化。
- **load 重载**：支持任意类型、集合大小类型、版本类型等的反序列化，自动断言类型安全。
- **use_array_optimization**：禁用数组优化（始终为 false）。

---

### 3. 归档类型定义

#### `naked_bson_iarchive`

```cpp
template<bool auto_id_skip>
class naked_bson_iarchive : public bson_iarchive_impl<naked_bson_iarchive<auto_id_skip>>
{
public:
    naked_bson_iarchive(buf_type& buf, unsigned int flags = 0);
    static bool is_skip_auto_id();
};
```

- **用途**：标准 BSON 输入归档，不包含 shared_ptr 辅助功能。
- **auto_id_skip**：模板参数，控制是否跳过自动 ID 字段。

#### `bson_iarchive`

```cpp
template<bool auto_id_skip>
class bson_iarchive : public bson_iarchive_impl<bson_iarchive<auto_id_skip>>
#if BOOST_VERSION < 105600
    , public boost::archive::detail::shared_ptr_helper
#endif
{
public:
    bson_iarchive(const buf_type& buf, unsigned int flags = 0);
    static bool is_skip_auto_id();
};
```

- **用途**：标准 BSON 输入归档，兼容 Boost 1.56.0 之前版本时自动包含 shared_ptr 辅助功能。
- **auto_id_skip**：模板参数，控制是否跳过自动 ID 字段。

---

### 4. 类型注册与序列化补丁

- `BOOST_SERIALIZATION_REGISTER_ARCHIVE(yggr::archive::bson_iarchive<true>)`
- `BOOST_SERIALIZATION_REGISTER_ARCHIVE(yggr::archive::bson_iarchive<false>)`
- 针对 `bson_iarchive` 和 `naked_bson_iarchive`，通过特化 `binary_data_wrap_traits`，指定二进制数据包装类型为 `c_bson_binary_buffer_ref`。
- 包含 `iserializer_patch.hpp`，对 Boost 的非指针类型序列化做补丁处理，并通过特化自动应用到本归档类型。

---

### 5. 兼容性与扩展

- 针对 Boost 1.56.0 之前版本，自动继承 `shared_ptr_helper`，以支持 shared_ptr 的特殊序列化需求。
- 支持自动跳过 BSON 的 auto_id 字段，适应不同业务需求。

---

## 命名空间

- 主要内容位于 `yggr::archive` 命名空间下
- 类型注册和补丁相关内容位于 `boost::archive::detail` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的 BSON 输入归档提供了标准实现，兼容 Boost.Serialization，支持类型注册、二进制包装、shared_ptr、自动 ID 跳过和序列化补丁，适用于高效的 BSON 数据反序列化场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 bson_oarchive.hpp 文件的文档说明：

---

# 文件：bson_oarchive.hpp

## 简介

该头文件定义了 Yggdrasil 框架下的 BSON 输出归档类 `bson_oarchive` 及其实现，支持将 C++ 对象序列化（写入）为 BSON 数据缓冲区。该类基于 Boost.Serialization 归档机制，支持 NLD（No Load 无法被反序列化）模式、类型注册、二进制数据包装和序列化补丁，适用于 MongoDB BSON 格式命令的高效序列化。

---

## 主要内容

### 1. 依赖

- `basic_bson_oarchive.hpp`：BSON 输出归档基础实现
- Boost.Serialization 相关头文件
- Yggdrasil 的 BSON 数据结构与辅助工具
- 归档数据包装 traits、序列化补丁等

---

### 2. 归档实现模板

#### `bson_oarchive_impl`

```cpp
template<typename Archive>
class bson_oarchive_impl : public basic_bson_oarchive<Archive>
{
    // 主要成员与方法见下文
};
```

- **用途**：为 BSON 输出归档提供底层实现，支持各种类型的序列化。
- **save 重载**：支持任意类型、集合大小类型、版本类型等的序列化，自动断言类型安全。
- **use_array_optimization**：禁用数组优化（始终为 false）。

---

### 3. 归档类型定义

#### `bson_oarchive`

```cpp
template<bool nld>
class bson_oarchive : public bson_oarchive_impl<bson_oarchive<nld>>
{
public:
    typedef yggr::nsql_database_system::c_bson buf_type;
    bson_oarchive(buf_type& buf, unsigned int flags = 0);
    ~bson_oarchive();
    static bool is_nld();
};
```

- **用途**：标准 BSON 输出归档，支持 NLD 模式。
- **nld**：模板参数，控制是否为 NLD 模式。

#### `naked_bson_oarchive`

```cpp
template<bool nld>
class naked_bson_oarchive : public bson_oarchive_impl<naked_bson_oarchive<nld>>
{
public:
    typedef yggr::nsql_database_system::c_bson buf_type;
    naked_bson_oarchive(buf_type& buf, unsigned int flags = 0);
    ~naked_bson_oarchive();
    static bool is_nld();
};
```

- **用途**：裸 BSON 输出归档，功能与 `bson_oarchive` 类似，不包含 shared_ptr 辅助功能。

---

### 4. 类型注册与序列化补丁

- `BOOST_SERIALIZATION_REGISTER_ARCHIVE(yggr::archive::bson_oarchive<true>)`
- `BOOST_SERIALIZATION_REGISTER_ARCHIVE(yggr::archive::bson_oarchive<false>)`
- 针对 `bson_oarchive` 和 `naked_bson_oarchive`，通过特化 `binary_data_wrap_traits`，指定二进制数据包装类型为 `c_bson_binary_buffer_ref`。
- 包含 `oserializer_patch.hpp`，对 Boost 的非指针类型序列化做补丁处理，并通过特化自动应用到本归档类型。

---

### 5. 兼容性与扩展

- 支持 NLD（No Length Data）模式，适应不同业务需求。
- 通过宏防止重复定义归档类型。

---

## 命名空间

- 主要内容位于 `yggr::archive` 命名空间下
- 类型注册和补丁相关内容位于 `boost::archive::detail` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的 BSON 输出归档提供了标准实现，兼容 Boost.Serialization，支持类型注册、二进制包装、NLD 模式和序列化补丁，适用于高效的 BSON 数据序列化场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 bson_serialize_mark.hpp 文件的文档说明：

---

# 文件：bson_serialize_mark.hpp

## 简介

该头文件定义了 Yggdrasil 框架下 BSON 序列化过程中的标记类型，用于标识 BSON 序列化时数组的起始和结束。通过这些标记类型，可以在归档实现中明确区分数组结构的边界，提升序列化/反序列化的类型安全性和可读性。

---

## 主要内容

### 1. 类定义

#### `bson_serialize_mark`

```cpp
class bson_serialize_mark
{
public:
    struct bson_mark_array_start {};
    struct bson_mark_array_end {};
};
```

- **用途**：作为 BSON 序列化过程中的辅助标记类型。
- **成员结构体**：
  - `bson_mark_array_start`：表示数组序列化的起始标记。
  - `bson_mark_array_end`：表示数组序列化的结束标记。

这些结构体通常在 BSON 归档实现中被用作类型标记，以便在序列化和反序列化时正确处理数组边界。

---

## 命名空间

- 所有内容位于 `yggr::archive` 命名空间下。

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 BSON 序列化过程提供了数组边界的类型安全标记，是 BSON 归档实现中处理复杂结构的基础工具。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 buffer_real_value_def.hpp 文件的文档说明：

---

# 文件：buffer_real_value_def.hpp

## 简介

该头文件为 Yggdrasil 框架下归档系统定义了缓冲区实际存储值类型的相关宏和类型别名。主要用于在归档过程中，根据不同字符类型（如 `char`、`wchar_t`）自动选择合适的实际存储类型，提升跨平台和多字符集环境下的兼容性和类型安全。

---

## 主要内容

### 1. 依赖

- `buffer_real_value_type_traits.hpp`：缓冲区实际值类型特性宏和工具
- Boost MPL：用于条件类型选择

---

### 2. 宏定义

#### `YGGR_ARCHIVE_BUFFER_REAL_VALUE_DEF`

```cpp
YGGR_ARCHIVE_BUFFER_REAL_VALUE_DEF(char, yggr::u8);
```

- **用途**：为 `char` 类型定义实际缓冲区值类型为 `yggr::u8`（通常为无符号8位整型）。

---

### 3. 宽字符类型适配

#### `wchar_value_type` 类型别名

```cpp
typedef boost::mpl::if_c<
    (sizeof(wchar_t) == 2),
    yggr::u16,
    yggr::u32
>::type wchar_value_type;
```

- **用途**：根据平台上 `wchar_t` 的字节数，自动选择实际缓冲区值类型：
  - 若 `wchar_t` 为2字节，则用 `yggr::u16`（16位无符号整型）
  - 否则用 `yggr::u32`（32位无符号整型）

#### 宏定义

```cpp
YGGR_ARCHIVE_BUFFER_REAL_VALUE_DEF(wchar_t, yggr::archive::detail::wchar_value_type)
```

- **用途**：为 `wchar_t` 类型定义实际缓冲区值类型为上面自动推导的 `wchar_value_type`。

---

## 命名空间

- 主要内容位于 `yggr::archive::detail` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为归档缓冲区的实际值类型提供了跨平台、类型安全的定义方式，确保在不同字符集和平台下归档数据的正确存储和读取。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 buffer_real_value_type_traits.hpp 文件的文档说明：

---

# 文件：buffer_real_value_type_traits.hpp

## 简介

该头文件为 Yggdrasil 框架归档系统提供了缓冲区实际存储值类型的类型萃取工具。通过模板和宏，可以为不同的源类型指定实际用于缓冲区存储的类型，便于归档系统在多字符集和多平台环境下实现类型安全的数据处理。

---

## 主要内容

### 1. 类型萃取模板

```cpp
template<typename T>
struct buffer_real_value
{
    typedef T type;
};
```

- **用途**：默认情况下，`buffer_real_value<T>::type` 就是 `T` 本身。
- **扩展**：可通过特化为某些类型指定不同的实际存储类型。

---

### 2. 类型特化宏

```cpp
#define YGGR_ARCHIVE_BUFFER_REAL_VALUE_DEF(__src__, __dst__) \
    namespace yggr{ namespace archive { \
        template<> struct buffer_real_value< __src__ > { \
             typedef __dst__ type; }; } }
```

- **用途**：为指定的源类型 `__src__` 定义实际缓冲区存储类型为 `__dst__`。
- **典型用法**：
    ```cpp
    YGGR_ARCHIVE_BUFFER_REAL_VALUE_DEF(char, yggr::u8)
    ```
    这将使 `buffer_real_value<char>::type` 为 `yggr::u8`，而不是 `char`。

---

## 命名空间

- 所有内容位于 `yggr::archive` 命名空间下。

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为归档缓冲区的实际值类型提供了模板化、可扩展的类型萃取机制，便于在不同字符集和平台下安全、灵活地处理归档数据的存储类型。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 net_iarchive_impl.hpp 文件的文档说明：

---

# 文件：net_iarchive_impl.hpp

## 简介

该头文件定义了 Yggdrasil 框架下的网络二进制输入归档实现模板类 `net_iarchive_impl`，用于从网络流（如 socket、网络缓冲区）中反序列化（读取）各种类型的数据。该类集成并扩展了 Boost.Serialization 的二进制归档机制，适配多字符集、多平台和网络字节序，支持高效的网络数据反序列化。

---

## 主要内容

### 1. 类模板 `net_iarchive_impl`

```cpp
template<typename Archive, typename Elem, typename Tr>
class net_iarchive_impl :
    public boost::archive::basic_binary_iprimitive<Archive, Elem, Tr>,
    public boost::archive::basic_binary_iarchive<Archive>
{
    // 主要成员与方法见下文
};
```

#### 主要类型定义

- 继承自 Boost 的二进制输入原语和归档基类，支持流缓冲区和输入流构造。
- 通过 `init(flags)` 初始化归档状态，支持无头模式。

#### 主要成员函数

- **load_override**  
  模板重载，支持对任意类型的反序列化，委托给基类处理。

- **load**  
  针对多种类型的专门反序列化实现，包括：
  - 集合大小类型（`boost::serialization::collection_size_type`、`yggr::serialization::collection_size_type`）
  - Boost 归档内部类型（如 `tracking_type`、`library_version_type`、`version_type`、`class_id_type`、`object_id_type`）
  - 字符串类型（`char*`、`wchar_t*`、`c8*`、`c16*`、`c32*` 及其 `std::basic_string` 和 `boost::container::basic_string` 变体）
  - 基本类型（`bool`、`s8`、`u8`、`s16`、`u16`、`s32`、`u32`、`s64`、`u64`、`f32`、`f64` 等）

- **网络字节序处理**  
  对多字节类型（如 `wchar_t`、`c16`、`c32`、`s16`、`u16`、`s32`、`u32`、`s64`、`u64`、`f32`、`f64` 等）自动进行网络字节序（ntoh）转换，保证跨平台数据一致性。

- **字符串处理**  
  - 对于单字节字符串，直接读取长度和内容。
  - 对于多字节字符串，读取后逐元素进行字节序转换。
  - 自动处理字符串结尾的空字符。

- **use_array_optimization**  
  嵌套结构体，指示对单字节类型启用数组优化，提高序列化性能。

---

## 特性与适配

- 支持多种字符集（char、wchar_t、char8_t、char16_t、char32_t）
- 支持标准库和 Boost.Container 的字符串类型
- 针对不同平台和编译器做了兼容性处理
- 适配 Boost.Serialization 的归档机制，支持集合大小类型的反序列化
- 自动处理网络字节序，适合网络通信场景

---

## 命名空间

- 所有内容位于 `yggr::archive` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的网络二进制输入归档提供了高效、类型安全的反序列化实现，兼容 Boost.Serialization，适用于多字符集、多平台和网络通信的二进制数据读取场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 net_iarchive.hpp 文件的文档说明：

---

# 文件：net_iarchive.hpp

## 简介

该头文件定义了 Yggdrasil 框架下的网络二进制输入归档类 `net_iarchive` 及其裸归档版本 `naked_net_iarchive`，用于从网络流（如 socket、网络缓冲区）中反序列化（读取）C++ 对象。该类基于 Boost.Serialization 的归档机制，支持类型注册、数组优化、shared_ptr 辅助和序列化补丁，适用于网络通信场景下的高效二进制反序列化。

---

## 主要内容

### 1. 依赖

- `net_iarchive_impl.hpp`：网络输入归档实现模板
- `archive_data_wrap_traits.hpp`：归档数据包装特性
- Boost.Serialization 相关头文件
- `iserializer_patch.hpp`：Boost 非指针类型序列化补丁

---

### 2. 类定义

#### `naked_net_iarchive`

```cpp
class naked_net_iarchive 
    : public net_iarchive_impl<
            yggr::archive::naked_net_iarchive, 
            std::istream::char_type, 
            std::istream::traits_type
        >
{
public:
    naked_net_iarchive(std::istream & is, unsigned int flags = 0);
    naked_net_iarchive(std::streambuf & bsb, unsigned int flags = 0);
};
```

- **用途**：标准网络输入归档，不包含 shared_ptr 辅助功能。
- **构造**：支持通过输入流或流缓冲区构造。

#### `net_iarchive`

```cpp
class net_iarchive
    : public net_iarchive_impl<
            yggr::archive::net_iarchive, 
            std::istream::char_type, 
            std::istream::traits_type
        >
#if BOOST_VERSION < 105600
    , public boost::archive::detail::shared_ptr_helper
#endif
{
public:
    net_iarchive(std::istream & is, unsigned int flags = 0);
    net_iarchive(std::streambuf & bsb, unsigned int flags = 0);
};
```

- **用途**：标准网络输入归档，兼容 Boost 1.56.0 之前版本时自动包含 shared_ptr 辅助功能。
- **构造**：支持通过输入流或流缓冲区构造。

---

### 3. 类型注册与序列化优化

- `BOOST_SERIALIZATION_REGISTER_ARCHIVE(yggr::archive::net_iarchive)`  
  注册归档类型，便于 Boost.Serialization 导出机制识别。
- `BOOST_SERIALIZATION_USE_ARRAY_OPTIMIZATION(yggr::archive::net_iarchive)`  
  启用数组序列化优化，提高性能。

---

### 4. 兼容性与补丁

- 针对 Boost 1.56.0 之前版本，自动继承 `shared_ptr_helper`，以支持 shared_ptr 的特殊序列化需求。
- 包含 `iserializer_patch.hpp`，对 Boost 的非指针类型序列化做补丁处理，并通过宏自动应用到本归档类型。

---

## 命名空间

- 主要内容位于 `yggr::archive` 命名空间下
- 类型注册相关内容位于 `boost` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的网络二进制输入归档提供了标准实现，兼容 Boost.Serialization，支持类型注册、数组优化、shared_ptr 特性和序列化补丁，适用于高效的网络数据反序列化场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 net_oarchive_impl.hpp 文件的文档说明：

---

# 文件：net_oarchive_impl.hpp

## 简介

该头文件定义了 Yggdrasil 框架下的网络二进制输出归档实现模板类 `net_oarchive_impl`，用于将各种类型的数据（包括多种字符串类型和基础类型）以网络字节序高效地序列化（写入）到网络流（如 socket、网络缓冲区）中。该类集成并扩展了 Boost.Serialization 的二进制归档机制，适配多字符集、多平台和网络通信场景。

---

## 主要内容

### 1. 类模板 `net_oarchive_impl`

```cpp
template<typename Archive, typename Elem, typename Tr>
class net_oarchive_impl :
    public boost::archive::basic_binary_oprimitive<Archive, Elem, Tr>,
    public boost::archive::basic_binary_oarchive<Archive>
{
    // 主要成员与方法见下文
};
```

#### 主要类型定义

- 继承自 Boost 的二进制输出原语和归档基类，支持流缓冲区和输出流构造。
- 通过 `init(flags)` 初始化归档状态，支持无头模式。

#### 主要成员函数

- **save_override**  
  模板重载，支持对任意类型的序列化，委托给基类处理。

- **save**  
  针对多种类型的专门序列化实现，包括：
  - 集合大小类型（`boost::serialization::collection_size_type`、`yggr::serialization::collection_size_type`）
  - Boost 归档内部类型（如 `tracking_type`、`library_version_type`、`version_type`、`class_id_type`、`object_id_type`）
  - 字符串类型（`char*`、`wchar_t*`、`c8*`、`c16*`、`c32*` 及其 `std::basic_string` 和 `boost::container::basic_string` 变体）
  - 基本类型（`bool`、`s8`、`u8`、`s16`、`u16`、`s32`、`u32`、`s64`、`u64`、`f32`、`f64` 等）

- **网络字节序处理**  
  对多字节类型（如 `wchar_t`、`c16`、`c32`、`s16`、`u16`、`s32`、`u32`、`s64`、`u64`、`f32`、`f64` 等）自动进行主机到网络字节序（hton）转换，保证跨平台数据一致性。

- **字符串处理**  
  - 对于单字节字符串，直接写入长度和内容。
  - 对于多字节字符串，写入前逐元素进行字节序转换。
  - 自动处理字符串结尾的空字符。

- **use_array_optimization**  
  嵌套结构体，指示对单字节类型启用数组优化，提高序列化性能。

---

## 特性与适配

- 支持多种字符集（char、wchar_t、char8_t、char16_t、char32_t）
- 支持标准库和 Boost.Container 的字符串类型
- 针对不同平台和编译器做了兼容性处理
- 适配 Boost.Serialization 的归档机制，支持集合大小类型的序列化
- 自动处理网络字节序，适合网络通信场景

---

## 命名空间

- 所有内容位于 `yggr::archive` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的网络二进制输出归档提供了高效、类型安全的序列化实现，兼容 Boost.Serialization，适用于多字符集、多平台和网络通信的二进制数据写入场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 net_oarchive.hpp 文件的文档说明：

---

# 文件：net_oarchive.hpp

## 简介

该头文件定义了 Yggdrasil 框架下的网络二进制输出归档类 `net_oarchive` 及其裸归档版本 `naked_net_oarchive`，用于将 C++ 对象以网络字节序高效序列化（写入）到网络流（如 socket、网络缓冲区）中。该类基于 Boost.Serialization 的归档机制，支持类型注册、数组优化和序列化补丁，适用于网络通信场景下的高效二进制序列化。

---

## 主要内容

### 1. 依赖

- `net_oarchive_impl.hpp`：网络输出归档实现模板
- `archive_data_wrap_traits.hpp`：归档数据包装特性
- Boost.Serialization 相关头文件
- `oserializer_patch.hpp`：Boost 非指针类型序列化补丁

---

### 2. 类定义

#### `net_oarchive`

```cpp
class net_oarchive 
    : public net_oarchive_impl<
            yggr::archive::net_oarchive, 
            std::ostream::char_type, 
            std::ostream::traits_type
        >
{
public:
    typedef std::ostream::char_type char_type;
    typedef std::ostream::traits_type traits_type;
    typedef net_oarchive_impl<
            yggr::archive::net_oarchive, 
            std::ostream::char_type, 
            std::ostream::traits_type
        > base_type;

    net_oarchive(std::ostream & os, unsigned int flags = 0);
    net_oarchive(std::streambuf & bsb, unsigned int flags = 0);
};
```

- **用途**：标准网络输出归档，支持通过输出流或流缓冲区构造。
- **继承**：基于 `net_oarchive_impl` 实现，建议如需扩展请继承自实现类而非本类，以保证静态多态性。
- **别名**：`typedef net_oarchive naked_net_oarchive;`  
  裸归档类型，功能等同于 `net_oarchive`。

---

### 3. 类型注册与序列化优化

- `BOOST_SERIALIZATION_REGISTER_ARCHIVE(yggr::archive::net_oarchive)`  
  注册归档类型，便于 Boost.Serialization 导出机制识别。
- `BOOST_SERIALIZATION_USE_ARRAY_OPTIMIZATION(yggr::archive::net_oarchive)`  
  启用数组序列化优化，提高性能。

---

### 4. 兼容性与补丁

- 包含 `oserializer_patch.hpp`，对 Boost 的非指针类型序列化做补丁处理，并通过宏自动应用到本归档类型。

---

## 命名空间

- 主要内容位于 `yggr::archive` 命名空间下
- 类型注册相关内容位于 `boost` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的网络二进制输出归档提供了标准实现，兼容 Boost.Serialization，支持类型注册、数组优化和序列化补丁，适用于高效的网络数据序列化场景。

找到具有 1 个许可证类型的类似代码

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 network_archive_partner.hpp 文件的文档说明：

---

# 文件：network_archive_partner.hpp

## 简介

该头文件定义了 Yggdrasil 框架下网络归档相关的“归档伙伴”类型（archive partner），用于描述和管理网络输入/输出归档的能力与辅助工具。通过宏或模板，统一了网络归档类型的元信息和能力检测接口，便于归档系统的扩展和维护，适用于网络通信场景下的数据序列化与反序列化。

---

## 主要内容

### 1. 依赖

- `archive_partner_template.hpp`：归档伙伴模板基础设施
- `string_archive_helper.hpp`：字符串归档辅助工具
- `net_iarchive.hpp` / `net_oarchive.hpp`：网络输入/输出归档
- `network/socket_conflict_fixer.hpp`：网络环境兼容性处理

---

### 2. 归档伙伴类型定义

根据是否定义 `YGGR_TPL_CONFIG_USING_TPL`，有两种实现方式：

#### 宏方式（默认）

使用 `YGGR_PP_ARCHIVE_PARTENER_TEMPLATE_DECL` 宏快速声明以下两种网络归档伙伴类型：

- `network_iarchive_partner`  
  - 归档类型：`archive::net_iarchive`
  - 辅助类型：`archive_helper::string_archive_helper<archive::net_iarchive>`
  - 支持模式：`archive_partner_t::E_Mode_Network`

- `network_oarchive_partner`  
  - 归档类型：`archive::net_oarchive`
  - 辅助类型：`archive_helper::string_archive_helper<archive::net_oarchive>`
  - 支持模式：`archive_partner_t::E_Mode_Network`

#### 模板方式

直接用 `archive_partner_template` 模板定义上述两种类型，功能等价。

---

### 3. 主要用途

这些归档伙伴类型用于：

- 统一描述网络归档类型的能力（如是否支持网络模式）
- 提供归档类型与辅助工具的类型信息
- 便于归档系统根据类型特性自动选择合适的归档实现

---

## 命名空间

- 所有内容位于 `yggr::archive::archive_partner` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的网络归档类型提供了统一的“伙伴”类型定义，是归档系统类型安全和能力检测的重要基础设施，便于网络数据的序列化与反序列化扩展。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 string_archive_helper.hpp 文件的文档说明：

---

# 文件：string_archive_helper.hpp

## 简介

该头文件定义了 Yggdrasil 框架下的字符串归档辅助工具模板类 `string_archive_helper`，用于简化字符串缓冲区的管理、对象的序列化与反序列化操作。该类为基于字符串流的归档（如文本归档、XML归档等）提供了统一的缓冲区操作接口和异常安全的序列化流程，适用于多种字符集和自定义字符串类型。

---

## 主要内容

### 1. 模板类 `string_archive_helper`

```cpp
template<
    typename Archive,
    typename Char = typename Archive::char_type,
    typename Traits = typename Archive::traits_type,
    typename Alloc = std::allocator<Char>,
    template<typename, typename, typename> class Basic_String = std::basic_string,
    template<typename, typename, typename> class OStringStream = std::basic_ostringstream,
    template<typename, typename, typename> class IStringStream = std::basic_istringstream
>
class string_archive_helper;
```

#### 主要类型定义

- `archive_type`：归档类型模板参数
- `char_type`、`traits_type`、`allocator_type`：字符类型、特性和分配器
- `buf_type`：缓冲区类型（如 `std::basic_string`）
- `output_stream_type` / `input_stream_type`：输出/输入字符串流类型

---

#### 主要缓冲区操作

- **拷贝与移动**
  - `buf_copy(buf1, buf2)`：支持右值引用和常量引用的缓冲区拷贝/移动，自动避免自拷贝。
- **交换**
  - `buf_swap(buf1, buf2)`：交换两个缓冲区内容，自动避免自交换。
- **调整大小**
  - `buf_resize(buf, size)`：调整缓冲区大小，若为0则清空。
- **指针与比较**
  - `buf_real_val_ptr(buf)`：获取缓冲区真实值指针
  - `buf_val_ptr(buf)`：获取缓冲区值指针
  - `buf_compare(buf1, buf2)`：比较两个缓冲区内容是否相等
- **大小与状态**
  - `buf_size(buf)`：获取缓冲区大小
  - `buf_empty(buf)`：判断缓冲区是否为空
  - `buf_clear(buf)`：清空缓冲区
  - `buf_init(buf)`：初始化缓冲区

---

#### 缓冲区赋值

- `buf_assign(buf, args...)`：支持 C++11 变参模板或宏展开，将参数赋值到缓冲区。

---

#### 序列化与反序列化

- `save(const Object& obj, buf_type& buf)`  
  将对象序列化为字符串缓冲区，异常安全，支持 Boost 异常和系统异常处理。
- `load(Object& obj, buf_type& buf)`  
  从字符串缓冲区反序列化对象，异常安全。

---

## 典型用法

```cpp
std::string buf;
MyObject obj;

// 序列化
yggr::archive::archive_helper::string_archive_helper<MyArchive>::save(obj, buf);

// 反序列化
yggr::archive::archive_helper::string_archive_helper<MyArchive>::load(obj, buf);
```

---

## 设计特点

- 统一的缓冲区操作接口，便于归档代码复用
- 支持多字符集和自定义字符串类型
- 支持 C++11 变参模板和 C++03 宏展开
- 异常安全，自动处理 Boost 和系统异常
- 适配 Yggdrasil 的归档系统

---

## 命名空间

- 所有内容位于 `yggr::archive::archive_helper` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的字符串归档提供了高效、类型安全的辅助工具，简化了缓冲区管理和对象序列化流程，适用于各种基于字符串流的归档场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 text_archive_partner.hpp 文件的文档说明：

---

# 文件：text_archive_partner.hpp

## 简介

该头文件定义了 Yggdrasil 框架下文本归档相关的“归档伙伴”类型（archive partner），用于描述和管理文本输入/输出归档（包括宽字符版本）的能力与辅助工具。通过宏或模板，统一了文本归档类型的元信息和能力检测接口，便于归档系统的扩展和维护，适用于文本格式的数据序列化与反序列化。

---

## 主要内容

### 1. 依赖

- `archive_partner_template.hpp`：归档伙伴模板基础设施
- `string_archive_helper.hpp`：字符串归档辅助工具
- `text_iarchive.hpp` / `text_oarchive.hpp`：文本输入/输出归档
- `text_wiarchive.hpp` / `text_woarchive.hpp`：宽字符文本输入/输出归档

---

### 2. 归档伙伴类型定义

根据是否定义 `YGGR_TPL_CONFIG_USING_TPL`，有两种实现方式：

#### 宏方式（默认）

使用 `YGGR_PP_ARCHIVE_PARTENER_TEMPLATE_DECL` 宏快速声明以下四种文本归档伙伴类型：

- `text_iarchive_partner`  
  - 归档类型：`yggr::archive::text_iarchive`
  - 辅助类型：`archive_helper::string_archive_helper<yggr::archive::text_iarchive>`
  - 支持模式：`archive_partner_t::E_Mode_Text`

- `text_oarchive_partner`  
  - 归档类型：`yggr::archive::text_oarchive`
  - 辅助类型：`archive_helper::string_archive_helper<yggr::archive::text_oarchive>`
  - 支持模式：`archive_partner_t::E_Mode_Text`

- `text_wiarchive_partner`  
  - 归档类型：`yggr::archive::text_wiarchive`
  - 辅助类型：`archive_helper::string_archive_helper<yggr::archive::text_wiarchive>`
  - 支持模式：`archive_partner_t::E_Mode_Text`

- `text_woarchive_partner`  
  - 归档类型：`yggr::archive::text_woarchive`
  - 辅助类型：`archive_helper::string_archive_helper<yggr::archive::text_woarchive>`
  - 支持模式：`archive_partner_t::E_Mode_Text`

#### 模板方式

直接用 `archive_partner_template` 模板定义上述四种类型，功能等价。

---

### 3. 主要用途

这些归档伙伴类型用于：

- 统一描述文本归档类型的能力（如是否支持文本模式）
- 提供归档类型与辅助工具的类型信息
- 便于归档系统根据类型特性自动选择合适的归档实现

---

## 命名空间

- 所有内容位于 `yggr::archive::archive_partner` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的文本归档类型（含宽字符）提供了统一的“伙伴”类型定义，是归档系统类型安全和能力检测的重要基础设施，便于文本数据的序列化与反序列化扩展。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 text_iarchive.hpp 文件的文档说明：

---

# 文件：text_iarchive.hpp

## 简介

该头文件定义了 Yggdrasil 框架下的文本输入归档类 `text_iarchive` 及其实现，支持从文本流（如 `std::istream`）中反序列化（读取）C++ 对象。该类基于 Boost.Serialization 的归档机制，扩展了多字符集和多种字符串类型的支持，并对 Boost 的序列化器做了补丁处理，适用于文本格式数据的高效反序列化。

---

## 主要内容

### 1. 依赖

- Boost.Serialization 相关头文件（如 text_iarchive.hpp）
- Yggdrasil 的归档实现与工具（如 `basic_text_iprimitive.hpp`、`archive_data_wrap_traits.hpp` 等）
- 字符串和集合大小类型支持
- Boost 类型工具与特性检测

---

### 2. 归档实现模板

#### `text_iarchive_impl`

```cpp
template<class Archive>
class text_iarchive_impl
    : public boost::archive::text_iarchive_impl<Archive>
{
    // 主要成员与方法见下文
};
```

- **用途**：为文本输入归档提供底层实现，支持多种字符串类型和字符集的反序列化。
- **load 重载**：支持 `char*`、`wchar_t*`、`c8*`、`c16*`、`c32*` 及其 `std::basic_string` 和 `boost::container::basic_string` 变体的反序列化。
- **集合大小类型支持**：支持 `boost::serialization::collection_size_type` 和 `yggr::serialization::collection_size_type`。
- **内部辅助函数**：`pro_load_const_char_pointer_1n` 用于处理多字符集字符串的读取。

---

### 3. 归档类型定义

#### `naked_text_iarchive`

```cpp
class naked_text_iarchive 
    : public yggr::archive::text_iarchive_impl<yggr::archive::naked_text_iarchive>
{
public:
    naked_text_iarchive(std::istream & is_, unsigned int flags = 0);
    ~naked_text_iarchive();
};
```

- **用途**：标准文本输入归档，不包含 shared_ptr 辅助功能。
- **构造**：支持通过输入流构造。

#### `text_iarchive`

```cpp
class text_iarchive 
    : public yggr::archive::text_iarchive_impl<yggr::archive::text_iarchive>
#if BOOST_VERSION < 105600
    , public boost::archive::detail::shared_ptr_helper
#endif
{
public:
    text_iarchive(std::istream & is_, unsigned int flags = 0);
    ~text_iarchive();
};
```

- **用途**：标准文本输入归档，兼容 Boost 1.56.0 之前版本时自动包含 shared_ptr 辅助功能。
- **构造**：支持通过输入流构造。

---

### 4. 类型注册与序列化补丁

- `BOOST_SERIALIZATION_REGISTER_ARCHIVE(yggr::archive::text_iarchive)`  
  注册归档类型，便于 Boost.Serialization 导出机制识别。
- 包含 `iserializer_patch.hpp`，对 Boost 的非指针类型序列化做补丁处理，并通过宏自动应用到本归档类型及裸归档类型。

---

### 5. 兼容性

- 针对 Boost 1.56.0 之前版本，自动继承 `shared_ptr_helper`，以支持 shared_ptr 的特殊序列化需求。
- 支持多字符集（如 char8_t、char16_t、char32_t）和多种字符串类型。

---

## 命名空间

- 主要内容位于 `yggr::archive` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的文本输入归档提供了标准实现，兼容 Boost.Serialization，支持多字符集、多字符串类型、类型注册和序列化补丁，适用于高效的文本数据反序列化场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 text_oarchive.hpp 文件的文档说明：

---

# 文件：text_oarchive.hpp

## 简介

该头文件定义了 Yggdrasil 框架下的文本输出归档类 `text_oarchive` 及其实现，支持将 C++ 对象以文本格式序列化（写入）到输出流（如 `std::ostream`）中。该类基于 Boost.Serialization 的归档机制，扩展了多字符集和多种字符串类型的支持，并对 Boost 的序列化器做了补丁处理，适用于文本格式数据的高效序列化。

---

## 主要内容

### 1. 依赖

- Boost.Serialization 相关头文件（如 text_oarchive.hpp）
- Yggdrasil 的归档实现与工具（如 `basic_text_oprimitive.hpp`、`archive_data_wrap_traits.hpp` 等）
- 字符串和集合大小类型支持
- Boost 类型工具与特性检测

---

### 2. 归档实现模板

#### `text_oarchive_impl`

```cpp
template<typename Archive>
class text_oarchive_impl
    : public boost::archive::text_oarchive_impl<Archive>
{
    // 主要成员与方法见下文
};
```

- **用途**：为文本输出归档提供底层实现，支持多种字符串类型和字符集的序列化。
- **save 重载**：
  - 支持 `char*`、`std::basic_string<char>`、`boost::container::basic_string<char>` 的序列化。
  - 支持 `wchar_t*`、`c8*`、`c16*`、`c32*` 及其 `std::basic_string` 和 `boost::container::basic_string` 变体的序列化（自动处理长度和字节宽度）。
  - 支持 `boost::serialization::collection_size_type` 和 `yggr::serialization::collection_size_type`。
  - 内部辅助函数 `pro_save_const_char_pointer_1n` 用于处理多字符集字符串的写入。
  - 针对 `c8`、`c16`、`c32` 类型，自动转换为合适的整型进行保存。

---

### 3. 归档类型定义

#### `text_oarchive`

```cpp
class text_oarchive
    : public yggr::archive::text_oarchive_impl<yggr::archive::text_oarchive>
{
public:
    text_oarchive(std::ostream & os_, unsigned int flags = 0);
    ~text_oarchive();
};
```

- **用途**：标准文本输出归档，支持通过输出流构造。
- **别名**：`typedef text_oarchive naked_text_oarchive;`  
  裸归档类型，功能等同于 `text_oarchive`。

---

### 4. 类型注册与序列化补丁

- `BOOST_SERIALIZATION_REGISTER_ARCHIVE(yggr::archive::text_oarchive)`  
  注册归档类型，便于 Boost.Serialization 导出机制识别。
- 包含 `oserializer_patch.hpp`，对 Boost 的非指针类型序列化做补丁处理，并通过宏自动应用到本归档类型。

---

### 5. 兼容性

- 支持多字符集（如 char8_t、char16_t、char32_t）和多种字符串类型。
- 针对 MSVC 编译器做了警告抑制处理。

---

## 命名空间

- 主要内容位于 `yggr::archive` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的文本输出归档提供了标准实现，兼容 Boost.Serialization，支持多字符集、多字符串类型、类型注册和序列化补丁，适用于高效的文本数据序列化场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 text_wiarchive.hpp 文件的文档说明：

---

# 文件：text_wiarchive.hpp

## 简介

该头文件定义了 Yggdrasil 框架下的宽字符文本输入归档类 `text_wiarchive` 及其实现，支持从宽字符文本流（如 `std::wistream`）中反序列化（读取）C++ 对象。该类基于 Boost.Serialization 的归档机制，扩展了多字符集和多种字符串类型的支持，并对 Boost 的序列化器做了补丁处理，适用于宽字符文本格式数据的高效反序列化。

---

## 主要内容

### 1. 依赖

- Boost.Serialization 相关头文件（如 text_wiarchive.hpp）
- Yggdrasil 的归档实现与工具（如 `basic_text_iprimitive.hpp`、`archive_data_wrap_traits.hpp` 等）
- 字符串和集合大小类型支持
- 字符集转换工具
- Boost 类型工具与特性检测

---

### 2. 归档实现模板

#### `text_wiarchive_impl`

```cpp
template<class Archive>
class text_wiarchive_impl : public boost::archive::text_wiarchive_impl<Archive>
{
    // 主要成员与方法见下文
};
```

- **用途**：为宽字符文本输入归档提供底层实现，支持多种字符串类型和字符集的反序列化。
- **load 重载**：
  - 支持 `char*`、`wchar_t*`、`c8*`、`c16*`、`c32*` 及其 `std::basic_string` 和 `boost::container::basic_string` 变体的反序列化。
  - 对于非 `char`/`wchar_t` 字符串类型，自动进行字符集转换。
  - 支持 `boost::serialization::collection_size_type` 和 `yggr::serialization::collection_size_type`。
- **内部辅助函数**：
  - `pro_load_const_wchar_t_pointer`：处理宽字符指针的读取。
  - `pro_load_wchar_t_string`：处理宽字符字符串的读取。
- **字符集转换**：对于不同字符集的字符串，自动使用 `charset_converter` 进行转换，确保类型安全和数据正确性。
- **特殊字符类型支持**：支持 `c8`、`c16`、`c32` 类型的读取和转换。

---

### 3. 归档类型定义

#### `naked_text_wiarchive`

```cpp
class naked_text_wiarchive 
    : public yggr::archive::text_wiarchive_impl<yggr::archive::naked_text_wiarchive>
{
public:
    naked_text_wiarchive(std::wistream & is, unsigned int flags = 0);
    ~naked_text_wiarchive();
};
```

- **用途**：标准宽字符文本输入归档，不包含 shared_ptr 辅助功能。
- **构造**：支持通过宽字符输入流构造。

#### `text_wiarchive`

```cpp
class text_wiarchive 
    : public yggr::archive::text_wiarchive_impl<yggr::archive::text_wiarchive>
#if BOOST_VERSION < 105600
    , public boost::archive::detail::shared_ptr_helper
#endif
{
public:
    text_wiarchive(std::wistream & is, unsigned int flags = 0);
    ~text_wiarchive();
};
```

- **用途**：标准宽字符文本输入归档，兼容 Boost 1.56.0 之前版本时自动包含 shared_ptr 辅助功能。
- **构造**：支持通过宽字符输入流构造。

---

### 4. 类型注册与序列化补丁

- `BOOST_SERIALIZATION_REGISTER_ARCHIVE(yggr::archive::text_wiarchive)`  
  注册归档类型，便于 Boost.Serialization 导出机制识别。
- 包含 `iserializer_patch.hpp`，对 Boost 的非指针类型序列化做补丁处理，并通过宏自动应用到本归档类型及裸归档类型。

---

### 5. 兼容性

- 针对 Boost 1.56.0 之前版本，自动继承 `shared_ptr_helper`，以支持 shared_ptr 的特殊序列化需求。
- 支持多字符集（如 char8_t、char16_t、char32_t）和多种字符串类型。
- 针对 MSVC 编译器做了警告抑制处理。

---

## 命名空间

- 主要内容位于 `yggr::archive` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的宽字符文本输入归档提供了标准实现，兼容 Boost.Serialization，支持多字符集、多字符串类型、类型注册和序列化补丁，适用于高效的宽字符文本数据反序列化场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 text_woarchive.hpp 文件的文档说明：

---

# 文件：text_woarchive.hpp

## 简介

该头文件定义了 Yggdrasil 框架下的宽字符文本输出归档类 `text_woarchive` 及其实现，支持将 C++ 对象以宽字符文本格式序列化（写入）到输出流（如 `std::wostream`）中。该类基于 Boost.Serialization 的归档机制，扩展了多字符集和多种字符串类型的支持，并对 Boost 的序列化器做了补丁处理，适用于宽字符文本格式数据的高效序列化。

---

## 主要内容

### 1. 依赖

- Boost.Serialization 相关头文件（如 text_woarchive.hpp）
- Yggdrasil 的归档实现与工具（如 `basic_text_oprimitive.hpp`、`archive_data_wrap_traits.hpp` 等）
- 字符串和集合大小类型支持
- 字符集转换工具
- Boost 类型工具与特性检测

---

### 2. 归档实现模板

#### `text_woarchive_impl`

```cpp
template<typename Archive>
class text_woarchive_impl : public boost::archive::text_woarchive_impl<Archive>
{
    // 主要成员与方法见下文
};
```

- **用途**：为宽字符文本输出归档提供底层实现，支持多种字符串类型和字符集的序列化。
- **save 重载**：
  - 支持 `char*`、`std::basic_string<char>`、`boost::container::basic_string<char>` 的序列化（自动转换为宽字符写入）。
  - 支持 `wchar_t*`、`std::basic_string<wchar_t>`、`boost::container::basic_string<wchar_t>` 直接写入。
  - 支持其它字符类型（如 `c8`、`c16`、`c32`）及其字符串的序列化，自动进行字符集转换。
  - 支持 `boost::serialization::collection_size_type` 和 `yggr::serialization::collection_size_type`。
  - 内部辅助函数 `pro_save_const_wchar_t_pointer`、`pro_save_wchar_t_string` 用于处理宽字符字符串的写入。
  - 针对 `c8`、`c16`、`c32` 类型，自动转换为合适的整型进行保存。

---

### 3. 归档类型定义

#### `text_woarchive`

```cpp
class text_woarchive 
    : public yggr::archive::text_woarchive_impl<yggr::archive::text_woarchive>
{
public:
    typedef std::wostream::char_type char_type;
    typedef std::wostream::traits_type traits_type;
    text_woarchive(std::wostream & os, unsigned int flags = 0);
    ~text_woarchive();
};
```

- **用途**：标准宽字符文本输出归档，支持通过宽字符输出流构造。
- **别名**：`typedef text_woarchive naked_text_woarchive;`  
  裸归档类型，功能等同于 `text_woarchive`。

---

### 4. 类型注册与序列化补丁

- `BOOST_SERIALIZATION_REGISTER_ARCHIVE(yggr::archive::text_woarchive)`  
  注册归档类型，便于 Boost.Serialization 导出机制识别。
- 包含 `oserializer_patch.hpp`，对 Boost 的非指针类型序列化做补丁处理，并通过宏自动应用到本归档类型。

---

### 5. 兼容性

- 针对 MSVC 编译器做了警告抑制处理。
- 支持多字符集（如 char8_t、char16_t、char32_t）和多种字符串类型。
- 自动进行字符集转换，确保不同字符类型的数据能正确序列化为宽字符流。

---

## 命名空间

- 主要内容位于 `yggr::archive` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的宽字符文本输出归档提供了标准实现，兼容 Boost.Serialization，支持多字符集、多字符串类型、类型注册和序列化补丁，适用于高效的宽字符文本数据序列化场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 xml_archive_helper.hpp 文件的文档说明：

---

# 文件：xml_archive_helper.hpp

## 简介

该头文件定义了 Yggdrasil 框架下的 XML 归档辅助工具模板类 `xml_archive_helper`，用于简化 XML 字符串缓冲区的管理、对象的序列化与反序列化操作。该类为基于 XML 的归档提供了统一的缓冲区操作接口和异常安全的序列化流程，适用于多种字符集和自定义字符串类型。

---

## 主要内容

### 1. 模板类 `xml_archive_helper`

```cpp
template<
    typename Archive,
    typename Char = typename Archive::char_type,
    typename Traits = typename Archive::traits_type,
    typename Alloc = std::allocator<Char>,
    template<typename, typename, typename> class Basic_String = std::basic_string,
    template<typename, typename, typename> class OStringStream = std::basic_ostringstream,
    template<typename, typename, typename> class IStringStream = std::basic_istringstream
>
class xml_archive_helper : private nonable::noncreateable
{
    // 主要成员与方法见下文
};
```

#### 主要类型定义

- `archive_type`：归档类型模板参数
- `char_type`、`traits_type`、`allocator_type`：字符类型、特性和分配器
- `buf_type`：缓冲区类型（如 `std::basic_string`）
- `output_stream_type` / `input_stream_type`：输出/输入字符串流类型
- `buf_val_type`、`buf_real_val_type`：缓冲区值类型及实际存储类型

---

#### 主要缓冲区操作

- **拷贝与移动**
  - `buf_copy(buf1, buf2)`：支持右值引用和常量引用的缓冲区拷贝/移动，自动避免自拷贝。
- **交换**
  - `buf_swap(buf1, buf2)`：交换两个缓冲区内容，自动避免自交换。
- **调整大小**
  - `buf_resize(buf, size)`：调整缓冲区大小，若为0则清空。
- **指针与比较**
  - `buf_real_val_ptr(buf)`：获取缓冲区真实值指针
  - `buf_val_ptr(buf)`：获取缓冲区值指针
  - `buf_compare(buf1, buf2)`：比较两个缓冲区内容是否相等
- **大小与状态**
  - `buf_size(buf)`：获取缓冲区大小
  - `buf_empty(buf)`：判断缓冲区是否为空
  - `buf_clear(buf)`：清空缓冲区
  - `buf_init(buf)`：初始化缓冲区

---

#### 缓冲区赋值

- `buf_assign(buf, args...)`：支持 C++11 变参模板或宏展开，将参数赋值到缓冲区。

---

#### 序列化与反序列化

- `save(const boost::serialization::nvp<Object>& nvp, buf_type& buf)`  
  将带名字值对的对象序列化为 XML 字符串缓冲区，异常安全。
- `save(const Object& obj, buf_type& buf)`  
  将对象序列化为 XML 字符串缓冲区，异常安全。
- `load(const boost::serialization::nvp<Object>& nvp, buf_type& buf)`  
  从 XML 字符串缓冲区反序列化带名字值对的对象，异常安全。
- `load(Object& obj, buf_type& buf)`  
  从 XML 字符串缓冲区反序列化对象，异常安全。

所有序列化/反序列化方法均自动处理 Boost 和系统异常，保证流程安全。

---

## 典型用法

```cpp
std::string buf;
MyObject obj;

// 序列化
yggr::archive::archive_helper::xml_archive_helper<MyArchive>::save(obj, buf);

// 反序列化
yggr::archive::archive_helper::xml_archive_helper<MyArchive>::load(obj, buf);
```

---

## 设计特点

- 统一的缓冲区操作接口，便于归档代码复用
- 支持多字符集和自定义字符串类型
- 支持 C++11 变参模板和 C++03 宏展开
- 异常安全，自动处理 Boost 和系统异常
- 适配 Yggdrasil 的归档系统

---

## 命名空间

- 所有内容位于 `yggr::archive::archive_helper` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的 XML 归档提供了高效、类型安全的辅助工具，简化了缓冲区管理和对象序列化流程，适用于各种基于 XML 的归档场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 xml_archive_partner.hpp 文件的文档说明：

---

# 文件：xml_archive_partner.hpp

## 简介

该头文件定义了 Yggdrasil 框架下 XML 归档相关的“归档伙伴”类型（archive partner），用于描述和管理 XML 输入/输出归档（包括宽字符版本）的能力与辅助工具。通过宏或模板，统一了 XML 归档类型的元信息和能力检测接口，便于归档系统的扩展和维护，适用于 XML 格式的数据序列化与反序列化。

---

## 主要内容

### 1. 依赖

- `archive_partner_template.hpp`：归档伙伴模板基础设施
- `xml_archive_helper.hpp`：XML 归档辅助工具
- `xml_oarchive.hpp` / `xml_iarchive.hpp`：XML 输出/输入归档
- `xml_woarchive.hpp` / `xml_wiarchive.hpp`：宽字符 XML 输出/输入归档

---

### 2. 归档伙伴类型定义

根据是否定义 `YGGR_TPL_CONFIG_USING_TPL`，有两种实现方式：

#### 宏方式（默认）

使用 `YGGR_PP_ARCHIVE_PARTENER_TEMPLATE_DECL` 宏快速声明以下四种 XML 归档伙伴类型：

- `xml_iarchive_partner`  
  - 归档类型：`yggr::archive::xml_iarchive`
  - 辅助类型：`archive_helper::xml_archive_helper<yggr::archive::xml_iarchive>`
  - 支持模式：`archive_partner_t::E_Mode_XML`

- `xml_oarchive_partner`  
  - 归档类型：`yggr::archive::xml_oarchive`
  - 辅助类型：`archive_helper::xml_archive_helper<yggr::archive::xml_oarchive>`
  - 支持模式：`archive_partner_t::E_Mode_XML`

- `xml_wiarchive_partner`  
  - 归档类型：`yggr::archive::xml_wiarchive`
  - 辅助类型：`archive_helper::xml_archive_helper<yggr::archive::xml_wiarchive>`
  - 支持模式：`archive_partner_t::E_Mode_XML`

- `xml_woarchive_partner`  
  - 归档类型：`yggr::archive::xml_woarchive`
  - 辅助类型：`archive_helper::xml_archive_helper<yggr::archive::xml_woarchive>`
  - 支持模式：`archive_partner_t::E_Mode_XML`

#### 模板方式

直接用 `archive_partner_template` 模板定义上述四种类型，功能等价。

---

### 3. 主要用途

这些归档伙伴类型用于：

- 统一描述 XML 归档类型的能力（如是否支持 XML 模式）
- 提供归档类型与辅助工具的类型信息
- 便于归档系统根据类型特性自动选择合适的归档实现

---

## 命名空间

- 所有内容位于 `yggr::archive::archive_partner` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的 XML 归档类型（含宽字符）提供了统一的“伙伴”类型定义，是归档系统类型安全和能力检测的重要基础设施，便于 XML 数据的序列化与反序列化扩展。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 xml_iarchive.hpp 文件的文档说明：

---

# 文件：xml_iarchive.hpp

## 简介

该头文件定义了 Yggdrasil 框架下的 XML 输入归档类 `xml_iarchive` 及其实现，支持从 XML 文本流（如 `std::istream`）中反序列化（读取）C++ 对象。该类基于 Boost.Serialization 的归档机制，扩展了多字符集和多种字符串类型的支持，并对 Boost 的序列化器做了补丁处理，适用于 XML 格式数据的高效反序列化。

---

## 主要内容

### 1. 依赖

- Boost.Serialization 相关头文件（如 xml_iarchive.hpp）
- Yggdrasil 的归档实现与工具（如 `basic_text_iprimitive.hpp`、`archive_data_wrap_traits.hpp` 等）
- 字符串和集合大小类型支持
- 字符集转换工具
- Boost 类型工具与特性检测

---

### 2. 归档实现模板

#### `xml_iarchive_impl`

```cpp
template<class Archive>
class xml_iarchive_impl : public boost::archive::xml_iarchive_impl<Archive>
{
    // 主要成员与方法见下文
};
```

- **用途**：为 XML 输入归档提供底层实现，支持多种字符串类型和字符集的反序列化。
- **load 重载**：
  - 支持 `char*`、`std::basic_string<char>`、`boost::container::basic_string<char>` 的反序列化。
  - 支持 `wchar_t*`、`std::basic_string<wchar_t>`、`boost::container::basic_string<wchar_t>` 的反序列化。
  - 支持其它字符类型（如 `c8`、`c16`、`c32`）及其字符串的反序列化，自动进行字符集转换。
  - 支持 `boost::serialization::collection_size_type` 和 `yggr::serialization::collection_size_type`。
- **内部辅助函数**：
  - `pro_load_char_string`：处理 `char` 字符串的读取。
  - `pro_load_wchar_t_string`：处理 `wchar_t` 字符串的读取和多字符集转换。
- **字符集转换**：对于不同字符集的字符串，自动使用 `charset_converter` 进行转换，确保类型安全和数据正确性。
- **特殊字符类型支持**：支持 `c8`、`c16`、`c32` 类型的读取和转换。

---

### 3. 归档类型定义

#### `naked_xml_iarchive`

```cpp
class naked_xml_iarchive
    : public yggr::archive::xml_iarchive_impl<yggr::archive::naked_xml_iarchive>
{
public:
    naked_xml_iarchive(std::istream & is, unsigned int flags = 0);
    ~naked_xml_iarchive();
};
```

- **用途**：标准 XML 输入归档，不包含 shared_ptr 辅助功能。
- **构造**：支持通过输入流构造。

#### `xml_iarchive`

```cpp
class xml_iarchive
    : public yggr::archive::xml_iarchive_impl<yggr::archive::xml_iarchive>
#if BOOST_VERSION < 105600
    , public boost::archive::detail::shared_ptr_helper
#endif
{
public:
    xml_iarchive(std::istream & is, unsigned int flags = 0);
    ~xml_iarchive();
};
```

- **用途**：标准 XML 输入归档，兼容 Boost 1.56.0 之前版本时自动包含 shared_ptr 辅助功能。
- **构造**：支持通过输入流构造。

---

### 4. 类型注册与序列化补丁

- `BOOST_SERIALIZATION_REGISTER_ARCHIVE(yggr::archive::xml_iarchive)`  
  注册归档类型，便于 Boost.Serialization 导出机制识别。
- 包含 `iserializer_patch.hpp`，对 Boost 的非指针类型序列化做补丁处理，并通过宏自动应用到本归档类型及裸归档类型。

---

### 5. 兼容性

- 针对 Boost 1.56.0 之前版本，自动继承 `shared_ptr_helper`，以支持 shared_ptr 的特殊序列化需求。
- 支持多字符集（如 char8_t、char16_t、char32_t）和多种字符串类型。
- 针对 MSVC 编译器做了警告抑制处理。

---

## 命名空间

- 主要内容位于 `yggr::archive` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的 XML 输入归档提供了标准实现，兼容 Boost.Serialization，支持多字符集、多字符串类型、类型注册和序列化补丁，适用于高效的 XML 数据反序列化场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 xml_oarchive.hpp 文件的文档说明：

---

# 文件：xml_oarchive.hpp

## 简介

该头文件定义了 Yggdrasil 框架下的 XML 输出归档类 `xml_oarchive` 及其实现，支持将 C++ 对象以 XML 格式序列化（写入）到输出流（如 `std::ostream`）中。该类基于 Boost.Serialization 的归档机制，扩展了多字符集和多种字符串类型的支持，并对 Boost 的序列化器做了补丁处理，适用于 XML 格式数据的高效序列化。

---

## 主要内容

### 1. 依赖

- Boost.Serialization 相关头文件（如 xml_oarchive.hpp）
- Yggdrasil 的归档实现与工具（如 `basic_text_oprimitive.hpp`、`basic_xml_oarchive.hpp`、`archive_serializer_map.hpp`、`xml_oarchive_impl.hpp` 等）
- 字符串和集合大小类型支持
- 字符集转换工具
- Boost 类型工具与特性检测

---

### 2. 归档实现模板

#### `xml_oarchive_impl`

```cpp
template<class Archive>
class xml_oarchive_impl : public boost::archive::xml_oarchive_impl<Archive>
{
    // 主要成员与方法见下文
};
```

- **用途**：为 XML 输出归档提供底层实现，支持多种字符串类型和字符集的序列化。
- **save 重载**：
  - 支持 `char*`、`std::basic_string<char>`、`boost::container::basic_string<char>` 的序列化（自动进行 XML 转义）。
  - 支持 `wchar_t*`、`std::basic_string<wchar_t>`、`boost::container::basic_string<wchar_t>` 直接写入。
  - 支持其它字符类型（如 `c8`、`c16`、`c32`）及其字符串的序列化，自动进行字符集转换。
  - 支持 `boost::serialization::collection_size_type` 和 `yggr::serialization::collection_size_type`。
  - 内部辅助函数 `pro_save_char_string`、`pro_save_wchar_t_string` 用于处理字符串的写入。
  - 针对 `c8`、`c16`、`c32` 类型，自动转换为合适的整型进行保存。

---

### 3. 归档类型定义

#### `xml_oarchive`

```cpp
class xml_oarchive 
    : public yggr::archive::xml_oarchive_impl<yggr::archive::xml_oarchive>
{
public:
    typedef std::ostream::char_type char_type;
    typedef std::ostream::traits_type traits_type;
    xml_oarchive(std::ostream & os, unsigned int flags = 0);
    ~xml_oarchive();
};
```

- **用途**：标准 XML 输出归档，支持通过输出流构造。
- **别名**：`typedef xml_oarchive naked_xml_oarchive;`  
  裸归档类型，功能等同于 `xml_oarchive`。

---

### 4. 类型注册与序列化补丁

- `BOOST_SERIALIZATION_REGISTER_ARCHIVE(yggr::archive::xml_oarchive)`  
  注册归档类型，便于 Boost.Serialization 导出机制识别。
- 包含 `oserializer_patch.hpp`，对 Boost 的非指针类型序列化做补丁处理，并通过宏自动应用到本归档类型。

---

### 5. 兼容性

- 支持多字符集（如 char8_t、char16_t、char32_t）和多种字符串类型。
- 针对 MSVC 编译器做了警告抑制处理。
- 自动进行字符集转换，确保不同字符类型的数据能正确序列化为 XML。

---

## 命名空间

- 主要内容位于 `yggr::archive` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的 XML 输出归档提供了标准实现，兼容 Boost.Serialization，支持多字符集、多字符串类型、类型注册和序列化补丁，适用于高效的 XML 数据序列化场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 xml_wiarchive.hpp 文件的文档说明：

---

# 文件：xml_wiarchive.hpp

## 简介

该头文件定义了 Yggdrasil 框架下的宽字符 XML 输入归档类 `xml_wiarchive` 及其实现，支持从宽字符 XML 文本流（如 `std::wistream`）中反序列化（读取）C++ 对象。该类基于 Boost.Serialization 的归档机制，扩展了多字符集和多种字符串类型的支持，并对 Boost 的序列化器做了补丁处理，适用于宽字符 XML 格式数据的高效反序列化。

---

## 主要内容

### 1. 依赖

- Boost.Serialization 相关头文件（如 xml_wiarchive.hpp）
- Yggdrasil 的归档实现与工具（如 `basic_text_iprimitive.hpp`、`basic_xml_iarchive.hpp`、`archive_serializer_map.hpp`、`xml_wiarchive_impl.hpp` 等）
- 字符串和集合大小类型支持
- 字符集转换工具
- Boost 类型工具与特性检测

---

### 2. 归档实现模板

#### `xml_wiarchive_impl`

```cpp
template<typename Archive>
class xml_wiarchive_impl : public boost::archive::xml_wiarchive_impl<Archive>
{
    // 主要成员与方法见下文
};
```

- **用途**：为宽字符 XML 输入归档提供底层实现，支持多种字符串类型和字符集的反序列化。
- **load 重载**：
  - 支持 `std::basic_string<char>`、`boost::container::basic_string<char>` 的反序列化（自动进行宽字符到多字节字符集转换）。
  - 支持 `std::wstring`、`std::basic_string<wchar_t>`、`boost::container::basic_string<wchar_t>` 的直接反序列化。
  - 支持其它字符类型（如 `c8`、`c16`、`c32`）及其字符串的反序列化，自动进行字符集转换。
  - 支持 `boost::serialization::collection_size_type` 和 `yggr::serialization::collection_size_type`。
- **内部辅助函数**：
  - `pro_load_char_string`：处理宽字符到多字节字符串的读取与转换。
  - `pro_load_wchar_t_stl_string`、`pro_load_wchar_t_string`：处理宽字符字符串的读取。
- **字符集转换**：对于不同字符集的字符串，自动使用 `charset_converter` 进行转换，确保类型安全和数据正确性。
- **特殊字符类型支持**：支持 `c8`、`c16`、`c32` 类型的读取和转换。

---

### 3. 归档类型定义

#### `naked_xml_wiarchive`

```cpp
class naked_xml_wiarchive 
    : public yggr::archive::xml_wiarchive_impl<yggr::archive::naked_xml_wiarchive>
{
public:
    naked_xml_wiarchive(std::wistream & is, unsigned int flags = 0);
    ~naked_xml_wiarchive();
};
```

- **用途**：标准宽字符 XML 输入归档，不包含 shared_ptr 辅助功能。
- **构造**：支持通过宽字符输入流构造。

#### `xml_wiarchive`

```cpp
class xml_wiarchive
    : public yggr::archive::xml_wiarchive_impl<yggr::archive::xml_wiarchive>
#if BOOST_VERSION < 105600
    , public boost::archive::detail::shared_ptr_helper
#endif
{
public:
    xml_wiarchive(std::wistream & is, unsigned int flags = 0);
    ~xml_wiarchive();
};
```

- **用途**：标准宽字符 XML 输入归档，兼容 Boost 1.56.0 之前版本时自动包含 shared_ptr 辅助功能。
- **构造**：支持通过宽字符输入流构造。

---

### 4. 类型注册与序列化补丁

- `BOOST_SERIALIZATION_REGISTER_ARCHIVE(yggr::archive::xml_wiarchive)`  
  注册归档类型，便于 Boost.Serialization 导出机制识别。
- 包含 `iserializer_patch.hpp`，对 Boost 的非指针类型序列化做补丁处理，并通过宏自动应用到本归档类型及裸归档类型。

---

### 5. 兼容性

- 针对 Boost 1.56.0 之前版本，自动继承 `shared_ptr_helper`，以支持 shared_ptr 的特殊序列化需求。
- 支持多字符集（如 char8_t、char16_t、char32_t）和多种字符串类型。
- 针对 MSVC 编译器做了警告抑制处理。

---

## 命名空间

- 主要内容位于 `yggr::archive` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的宽字符 XML 输入归档提供了标准实现，兼容 Boost.Serialization，支持多字符集、多字符串类型、类型注册和序列化补丁，适用于高效的宽字符 XML 数据反序列化场景。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: 以下是 xml_woarchive.hpp 文件的文档说明：

---

# 文件：xml_woarchive.hpp

## 简介

该头文件定义了 Yggdrasil 框架下的宽字符 XML 输出归档类 `xml_woarchive` 及其实现，支持将 C++ 对象以宽字符 XML 格式序列化（写入）到输出流（如 `std::wostream`）中。该类基于 Boost.Serialization 的归档机制，扩展了多字符集和多种字符串类型的支持，并对 Boost 的序列化器做了补丁处理，适用于宽字符 XML 格式数据的高效序列化。

---

## 主要内容

### 1. 依赖

- Boost.Serialization 相关头文件（如 xml_woarchive.hpp）
- Yggdrasil 的归档实现与工具（如 `basic_text_oprimitive.hpp`、`basic_xml_oarchive.hpp`、`archive_serializer_map.hpp`、`xml_woarchive_impl.hpp` 等）
- 字符串和集合大小类型支持
- 字符集转换工具（如 `charset_converter`）
- Boost 类型工具与特性检测

---

### 2. 归档实现模板

#### `xml_woarchive_impl`

```cpp
template<typename Archive>
class xml_woarchive_impl : public boost::archive::xml_woarchive_impl<Archive>
{
    // 主要成员与方法见下文
};
```

- **用途**：为宽字符 XML 输出归档提供底层实现，支持多种字符串类型和字符集的序列化。
- **save 重载**：
  - 支持 `char*`、`std::basic_string<char>`、`boost::container::basic_string<char>` 的序列化（自动进行 XML 转义）。
  - 支持 `wchar_t*`、`std::basic_string<wchar_t>`、`boost::container::basic_string<wchar_t>` 直接写入。
  - 支持其它字符类型（如 `c8`、`c16`、`c32`）及其字符串的序列化，自动进行字符集转换。
  - 支持 `boost::serialization::collection_size_type` 和 `yggr::serialization::collection_size_type`。
  - 内部辅助函数 `pro_save_char_string`、`pro_save_wchar_t_string` 用于处理字符串的写入。
  - 针对 `c8`、`c16`、`c32` 类型，自动转换为合适的整型进行保存。

---

### 3. 归档类型定义

#### `xml_woarchive`

```cpp
class xml_woarchive 
    : public yggr::archive::xml_woarchive_impl<yggr::archive::xml_woarchive>
{
public:
    typedef std::wostream::char_type char_type;
    typedef std::wostream::traits_type traits_type;
    xml_woarchive(std::wostream & os, unsigned int flags = 0);
    ~xml_woarchive();
};
```

- **用途**：标准宽字符 XML 输出归档，支持通过宽字符输出流构造。
- **别名**：`typedef xml_woarchive naked_xml_woarchive;`  
  裸归档类型，功能等同于 `xml_woarchive`。

---

### 4. 类型注册与序列化补丁

- `BOOST_SERIALIZATION_REGISTER_ARCHIVE(yggr::archive::xml_woarchive)`  
  注册归档类型，便于 Boost.Serialization 导出机制识别。
- 包含 `oserializer_patch.hpp`，对 Boost 的非指针类型序列化做补丁处理，并通过宏自动应用到本归档类型。

---

### 5. 兼容性

- 支持多字符集（如 char8_t、char16_t、char32_t）和多种字符串类型。
- 针对 MSVC 编译器做了警告抑制处理。
- 自动进行字符集转换，确保不同字符类型的数据能正确序列化为宽字符 XML。

---

## 命名空间

- 主要内容位于 `yggr::archive` 命名空间下

---

## 版权声明

本文件遵循 MIT 许可证，允许自由使用、修改和分发。

---

## 总结

本文件为 Yggdrasil 框架下的宽字符 XML 输出归档提供了标准实现，兼容 Boost.Serialization，支持多字符集、多字符串类型、类型注册和序列化补丁，适用于高效的宽字符 XML 数据序列化场景。