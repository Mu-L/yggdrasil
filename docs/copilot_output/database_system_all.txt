alucard-dracula: 为这个文件生成文档


GitHub Copilot: `basic_database_accesser.hpp` 文档

# 文件概述

该头文件定义了 `yggr::database_system::basic_database_accesser` 类及其相关辅助结构，主要用于对数据库的基本访问操作（如增删改查、SQL执行等）进行统一封装和异常处理。该类为数据库访问提供了模板化的静态方法，支持多种容器和自定义处理器，便于扩展和适配不同数据库实现。

---

## 命名空间

- `yggr::database_system`
- `yggr::database_system::detail`

---

## 主要结构与类

### 1. `keep_connect_helper`
- 作用：确保数据库连接处于连接状态，若未连接则尝试重连，并处理异常。
- 用法：作为连接操作的前置检查。

### 2. `connection_using_handler_helper<Ret>`
- 作用：模板结构体，封装了“安全地获取连接、执行处理器、异常处理、归还连接”的完整流程。
- 特化版本支持 `void` 返回类型。

### 3. `basic_database_accesser`
- 主要功能：提供一组静态模板方法，支持数据库的 select、insert、update、delete、execute_sql 等操作。
- 设计特点：
  - 所有操作均通过模板参数适配不同的连接类型、数据容器和数据类型。
  - 支持自定义数据处理器（如 handler_val_maker）以适配复杂的数据转换需求。
  - 内部统一处理连接的获取、异常捕获、连接归还、事务提交/回滚等细节，简化上层调用。
  - 提供了事务相关的私有辅助方法（commit/rollback）。

---

## 主要接口说明

### 连接管理
- `s_org_keep_connect`：确保连接可用，必要时自动重连。

### 查询操作
- `s_org_select_records_of_view`：从数据库视图中查询数据，支持自定义数据类型和处理器。

### 插入操作
- `s_org_insert_records_of_table`：向数据库表插入数据，支持批量插入和自定义数据转换。

### 更新操作
- `s_org_update_records_of_table`：更新数据库表中的数据，支持批量和自定义处理。

### 删除操作
- `s_org_delete_records_of_table`：删除数据库表中的数据，支持批量和自定义处理。

### SQL 执行
- `s_org_execute_sql`：直接执行 SQL 语句，支持事务控制。

### 通用处理器调用
- `s_org_connection_using_handler`：以安全方式获取连接并执行自定义处理器，自动处理异常和连接归还。

---

## 错误处理

- 所有操作均通过 `dtl_error` 类型返回详细错误信息，便于上层捕获和处理。
- 支持自动回滚和提交事务，保证数据一致性。

---

## 适用场景

- 需要对数据库进行统一、类型安全、异常安全的访问封装时。
- 适用于多种数据库连接池、数据类型和容器的场景。
- 便于扩展和适配不同数据库实现。

---

## 版权声明

```
Copyright (c) 2010-2024 yggdrasil
author: xu yang
MIT License
```

---

如需详细接口用法或示例，请参考具体函数模板定义及注释。

alucard-dracula: 为这个文件生成文档


GitHub Copilot: `database_accesser.hpp` 文档

# 文件概述

该头文件定义了 `yggr::database_system::database_accesser` 类，是对 `basic_database_accesser` 的进一步封装，提供了更友好的接口以支持多字符集（如 UTF-8）和多种字符串类型的数据库操作。该类通过静态模板方法，简化了数据库的增删改查、SQL 执行等常用操作，并自动处理字符串编码转换。

---

## 命名空间

- `yggr::database_system`

---

## 主要类

### 1. `database_accesser`
- 继承自 `basic_database_accesser`，对其接口进行扩展和适配。
- 主要功能：
  - 支持多种字符串类型（如 `std::string`、`yggr::charset::utf8_string` 等）作为表名、SQL 语句等参数。
  - 自动进行字符串编码转换，保证数据库操作的兼容性和安全性。
  - 保留了所有基础的数据库操作接口，并通过模板和 SFINAE 技术保证类型安全。

---

## 主要接口说明

### 连接管理
- `s_keep_connect`：确保数据库连接可用，自动重连。

### 查询操作
- `s_select_records_of_view`：从数据库视图中查询数据，支持自定义数据类型、容器和处理器，自动处理字符串编码。

### 插入操作
- `s_insert_records_of_table`：向数据库表插入数据，支持批量插入、自定义数据转换和事务控制。

### 更新操作
- `s_update_records_of_table`：更新数据库表中的数据，支持批量、自定义处理和事务控制。

### 删除操作
- `s_delete_records_of_table`：删除数据库表中的数据，支持批量、自定义处理和事务控制。

### SQL 执行
- `s_execute_sql`：执行 SQL 语句，支持多种字符串类型和事务控制。
- `s_execute_sql_non_conv`：直接执行原始字符串类型的 SQL 语句（不做编码转换）。

### 通用处理器调用
- `s_connection_using_handler`：以安全方式获取连接并执行自定义处理器，自动处理异常和连接归还。

---

## 技术要点

- **字符串兼容性**：通过 `charset::utf8_string_constructable`、`database_string_helper::s_conv` 等机制，自动将各种字符串类型转换为数据库可用的格式。
- **类型安全**：大量使用模板和 SFINAE（`boost::enable_if`、`boost::mpl::and_`）保证只有合适的类型才能调用相关接口。
- **异常安全**：所有操作均通过 `error_type` 返回详细错误信息，便于上层捕获和处理。
- **事务支持**：所有增删改操作均支持事务提交与回滚参数。

---

## 适用场景

- 需要对数据库进行统一、类型安全、字符集友好的访问封装时。
- 适用于多种数据库连接池、数据类型和容器的场景。
- 便于扩展和适配不同数据库实现，尤其适合多语言环境下的数据库操作。

---

## 版权声明

```
Copyright (c) 2010-2024 yggdrasil
author: xu yang
MIT License
```

---

如需详细接口用法或示例，请参考具体函数模板定义及注释。

alucard-dracula: 为这个文件生成文档


GitHub Copilot: `database_async_mgr.hpp` 文档

# 文件概述

该头文件定义了 `yggr::database_system::database_async_mgr` 模板类，是一个通用的异步数据库管理器，基于 `dbs_manager::async_dbs_mgr` 实现。它支持多种数据库连接类型、访问器、用户自定义数据和线程配置，适用于需要异步数据库操作的高性能场景。

---

## 命名空间

- `yggr::database_system`

---

## 主要类型

### 1. `basic_db_notify` / `db_notify`
- 说明：直接使用 `dbs_manager` 命名空间下的通知类型，便于数据库操作的事件通知和回调。

### 2. `database_async_mgr` 模板类

#### 模板参数
- `Key`：数据库连接的键类型（如标识符、名称等）。
- `Conn`：数据库连接类型。
- `Accesser`：数据库访问器类型，默认为 `database_accesser`。
- `InUserData`：输入用户数据类型，默认为 `yggr::any`。
- `OutUserData`：输出用户数据类型，默认为 `yggr::any`。
- `Thread_Config`：线程配置类型，默认为 `thread::boost_thread_config_type`。

#### 继承关系
- 继承自 `dbs_manager::async_dbs_mgr`，复用其异步管理能力。

#### 主要成员类型
- `key_type`：键类型。
- `conn_type`：连接类型。
- `accesser_type`：访问器类型。
- `in_user_data_type` / `out_user_data_type`：用户数据类型。
- `init_type`：初始化参数类型。

#### 构造与析构
- 支持 C++11 可变参数模板构造（或预处理器宏展开的多参数构造），可灵活传递初始化参数。
- 支持通过 `init_type` 直接初始化。
- 析构函数默认。

#### 主要接口（继承自基类）
- `async_execute`：异步执行数据库操作。
- `start`：启动异步管理器。
- `is_running`：判断管理器是否正在运行。
- `stop`：停止异步管理器。
- `join`：等待所有线程结束。
- `clear_notify`：清除所有通知。
- `clear`：清理所有资源。

---

## 技术要点

- **异步管理**：通过线程池或异步任务队列，实现数据库操作的异步化，提升并发性能。
- **高度可配置**：支持自定义连接类型、访问器、用户数据和线程模型，适应多种业务场景。
- **事件通知**：集成通知机制，便于任务完成、异常等事件的回调处理。
- **兼容 C++11 及更早标准**：通过宏和可变参数模板兼容不同编译环境。

---

## 适用场景

- 需要高并发、异步数据库访问的服务端或中间件系统。
- 需要统一管理多种数据库连接、支持多种数据类型和自定义访问逻辑的复杂系统。
- 需要事件驱动、任务队列等异步处理机制的数据库应用。

---

## 版权声明

```
Copyright (c) 2010-2024 yggdrasil
author: xu yang
MIT License
```

---

如需详细接口用法或示例，请参考基类 `async_dbs_mgr` 及相关文档。

alucard-dracula: 为这个文件生成文档


GitHub Copilot: database_calculator.hpp 文档

# 文件概述

该头文件定义了 `yggr::database_system::database_calculator` 模板类，是一个可扩展的数据库计算/调度器，结合数据库管理器、命令分发和线程动作表，实现了数据库操作的统一注册、调度和执行。适用于需要将数据库操作与命令、所有者信息、异步/多线程处理结合的复杂业务场景。

---

## 命名空间

- `yggr::database_system`

---

## 主要模板类

### `database_calculator`

#### 模板参数
- `OwnerInfo`：所有者信息类型（如用户ID、会话ID等）。
- `Command`：数据库命令类型（如封装的SQL操作、命令对象等）。
- `DB_OP`：数据库操作器类型（如数据库连接/访问器）。
- `OwnerInfo_Container`：所有者信息容器类型，默认为 `boost::unordered_multiset<OwnerInfo>`。
- `Base`：数据库管理器基类模板，默认为 `database_mgr`。

#### 继承关系
- 继承自 `boost::enable_shared_from_this`，支持智能指针安全引用。
- 继承自 `Base<DB_OP>`，复用数据库管理能力。

#### 主要类型定义
- `owner_info_type`、`command_type`、`db_op_type`、`conn_type`、`base_type` 等，便于类型适配和扩展。
- 内部引用计数类型 `ref_count_info_type`，用于线程安全。

#### 构造与析构
- 构造函数支持数据库连接字符串、提示和自动提交参数。
- 析构函数默认。

#### 主要接口

- `register_cal_object`  
  注册数据库计算对象到动作表（`Action_Table`），并绑定命令处理回调。支持带/不带 SEH（结构化异常处理）的两种实现。
  - `Runner`：执行器类型。
  - `Action_Table`：动作表类型。
  - `Recv_Handler`：接收处理器类型。

- `cal_db_command_type`  
  实际的数据库命令调度与执行逻辑。根据命令内容调用基类的 `execute_view` 方法。

- `handler_seh`  
  （可选）SEH异常处理回调，仅在定义 `YGGR_USE_SEH` 时启用。

---

## 技术要点

- **命令分发**：通过注册机制，将数据库命令与处理器、动作表绑定，实现灵活的命令调度。
- **线程安全**：内部引用计数锁保证多线程环境下的安全。
- **可扩展性**：模板参数高度可定制，适应不同业务需求。
- **异常处理**：可选支持 SEH，增强健壮性。

---

## 适用场景

- 需要将数据库操作与命令、所有者信息、线程动作表结合的复杂业务系统。
- 需要支持多用户、多会话、异步/多线程数据库调度的服务端或中间件。
- 需要灵活扩展数据库操作、命令类型和分发机制的场景。

---

## 版权声明

```
Copyright (c) 2014-2022 yggdrasil
author: xu yang
MIT License
```

---

如需详细接口用法或示例，请参考具体模板参数和成员函数定义。

alucard-dracula: 为这个文件生成文档


GitHub Copilot: `database_charset_config.hpp` 文档

# 文件概述

该头文件定义了数据库系统的字符集配置工具类 `yggr::database_system::database_charset_config`，用于统一管理和获取数据库默认字符集名称。通过宏和静态方法，支持灵活切换和获取当前数据库字符集，便于多字符集环境下的数据库开发。

---

## 命名空间

- `yggr::database_system`

---

## 主要内容

### 1. 宏定义

- `TAG_YGGR_DATABASE_CHARSET_NAME`  
  若未定义，则默认使用 `TAG_YGGR_UTF8_STRING_CHARSET_NAME`，即 UTF-8 字符集。

- `YGGR_DATABASE_CHARSET_NAME()`  
  获取当前数据库字符集名称的 C 字符串指针。

- `YGGR_STR_DATABASE_CHARSET_NAME()`  
  获取当前数据库字符集名称的 `string` 类型引用。

---

### 2. 类 `database_charset_config`

- **静态方法**
  - `get_default_database_charset_name()`  
    返回当前数据库默认字符集名称（`const char*`）。若与 UTF-8 相同，则返回内部默认字符集，否则返回宏定义的字符集名。

  - `get_str_default_database_charset_name()`  
    返回当前数据库默认字符集名称（`const string&`）。同样根据宏定义和 UTF-8 判断返回。

---

## 技术要点

- **灵活性**：通过宏和静态方法，支持在编译期或运行期灵活切换数据库字符集。
- **兼容性**：默认支持 UTF-8，也可通过宏自定义其他字符集，适应不同数据库和国际化需求。
- **统一入口**：所有字符集相关操作均通过该类和宏进行，便于维护和扩展。

---

## 适用场景

- 需要支持多字符集或国际化的数据库应用。
- 需要统一管理和切换数据库字符集配置的项目。
- 需要与 yggr 框架其他字符集相关模块协同工作的场景。

---

## 版权声明

```
Copyright (c) 2010-2024 yggdrasil
author: xu yang
MIT License
```

---

如需详细用法，请参考具体宏和静态方法定义。

alucard-dracula: 为这个文件生成文档


GitHub Copilot: `database_check_operator.hpp` 文档

# 文件概述

该头文件定义了 `yggr::database_system::database_check_operator` 工具类，主要用于生成数据库操作相关的命令ID和表名字符串。该类为数据库命令分发、日志、调试等场景提供了统一的字符串生成工具。

---

## 命名空间

- `yggr::database_system`

---

## 主要类

### `database_check_operator`

#### 主要静态方法

- `make_database_command_id(const std::string& op_str)`  
  模板方法，根据操作字符串和视图结构类型生成唯一的数据库命令ID。  
  - `View_Struct`：视图结构体类型。
  - `op_str`：操作字符串（如"select"、"insert"等）。
  - 返回值：格式为 `"op_str, typeid(View_Struct).name()"` 的字符串。

- `make_database_command_id(const std::string& op_str, const std::string& type_str)`  
  根据操作字符串和类型字符串生成数据库命令ID。  
  - `op_str`：操作字符串。
  - `type_str`：类型字符串。
  - 返回值：格式为 `"op_str, type_str"` 的字符串。

- `make_table_names(const std::vector<std::string>& tb_names)`  
  将表名数组拼接为逗号分隔的字符串。  
  - `tb_names`：表名字符串数组。
  - 返回值：如 `"table1, table2, table3"` 的字符串。

---

## 技术要点

- **命令唯一性**：通过类型信息和操作名组合，确保数据库命令ID唯一，便于调度和日志追踪。
- **字符串拼接**：高效生成多表操作的表名字符串，适合SQL语句拼接和日志输出。
- **模板与重载**：支持类型安全的命令ID生成，也支持自定义类型字符串。

---

## 适用场景

- 数据库命令分发、调度、日志记录、调试等需要唯一标识和描述数据库操作的场景。
- 多表操作、动态SQL生成等需要表名字符串拼接的场景。

---

## 版权声明

```
Copyright (c) 2010-2022 yggdrasil
author: xu yang
MIT License
```

---

如需详细用法，请参考各静态方法定义。

alucard-dracula: 为这个文件生成文档


GitHub Copilot: `database_command.hpp` 文档

# 文件概述

该头文件定义了 `yggr::database_system::database_command` 模板类，是数据库操作命令的通用封装。该类用于描述一次数据库操作的类型、目标表、操作后缀等关键信息，并支持序列化、拷贝、移动等操作，便于在任务中心、分布式系统等场景下传递和管理数据库命令。

---

## 命名空间

- `yggr::database_system`

---

## 主要模板类

### `database_command`

#### 模板参数
- `Pak_ID`：包ID类型，默认 `u32`。
- `Ver`：版本号类型，默认 `u16`。
- `Task_Data_Info`：任务数据类型，默认 `task_center::default_task_data_info_type`。

#### 主要类型定义
- `pak_id_type`、`pak_ver_type`、`task_data_info_type`：类型适配。
- `tb_names_type`：表名数组类型（`std::vector<std::string>`）。

#### 主要成员变量
- `_op_str`：操作字符串（如"select"、"insert"等）。
- `_type_str`：类型字符串（如表结构类型名）。
- `_tb_names`：表名数组。
- `_postfix_str`：SQL后缀字符串（如条件、排序等）。

#### 主要接口

- 构造与赋值
  - 支持默认、参数、拷贝、移动构造与赋值，兼容 C++11 及更早标准。
  - `swap` 方法支持高效交换内容。

- 访问器
  - `id()`：生成唯一命令ID（基于操作和类型字符串）。
  - `get_tb_names()`：获取表名数组。
  - `get_postfix_str()`：获取SQL后缀字符串。

- 任务中心集成
  - `YGGR_FAST_CAL_TASK_IMPORT` 宏：便于与任务中心系统集成，实现序列化、分发等功能。

---

## 技术要点

- **命令封装**：统一描述数据库操作的关键信息，便于调度、日志、分发。
- **类型安全**：模板参数可自定义，适应不同业务需求。
- **高效拷贝/移动**：支持现代C++的拷贝、移动语义，提升性能。
- **与任务系统集成**：可直接作为任务中心的数据类型，支持分布式、异步处理。

---

## 适用场景

- 需要统一封装和传递数据库操作命令的分布式系统、任务中心、异步调度等场景。
- 需要对数据库操作进行唯一标识、日志记录、类型安全管理的场景。

---

## 版权声明

```
Copyright (c) 2010-2022 yggdrasil
author: xu yang
MIT License
```

---

如需详细用法，请参考构造函数、成员函数及相关宏定义。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: `database_connection_init.hpp` 文档

# 文件概述

该头文件定义了 `yggr::database_system::database_connection_init` 类，用于封装数据库连接初始化参数（如DSN、提示、自动提交等），并提供多种字符集和分配器兼容的访问与转换接口。该类便于在多字符集、多平台环境下安全、灵活地管理数据库连接配置。

---

## 命名空间

- `yggr::database_system`
- `yggr::database_system::swap_support`

---

## 主要类

### `database_connection_init`

#### 主要成员变量
- `_dsn`：数据库连接字符串（支持多字符集）。
- `_bprompt`：是否弹出提示（如登录对话框）。
- `_bauto_commit`：是否自动提交事务。

#### 主要接口

- **构造与赋值**
  - 支持默认、拷贝、移动构造与赋值，兼容C++11及更早标准。
  - 支持通过任意可构造为utf8_string的字符串类型初始化DSN。

- **DSN访问与转换**
  - `dsn_string()`：获取/设置原始DSN字符串。
  - `dsn_string(const Alloc&)`：使用指定分配器获取DSN字符串。
  - `dsn_string(const string& charset_name)`：转换为指定字符集的字符串。
  - `dsn_string(const Alloc&, const string& charset_name)`：分配器+字符集双重自定义。

- **参数访问**
  - `prompt()`：获取/设置是否弹出提示。
  - `auto_commit()`：获取/设置是否自动提交。

- **swap支持**
  - 提供高效的swap实现，便于容器操作和性能优化。

---

## 技术要点

- **字符集兼容**：支持多字符集DSN输入与输出，适应国际化和多数据库环境。
- **分配器兼容**：支持自定义分配器，便于与STL容器集成。
- **高效拷贝/移动**：支持现代C++的拷贝、移动语义。
- **swap友好**：提供标准和boost命名空间下的swap重载。

---

## 适用场景

- 需要灵活配置和管理数据库连接参数的中间件、ORM、数据库驱动等。
- 需要支持多字符集、跨平台、分布式数据库环境的项目。
- 需要高效容器操作和内存管理的数据库连接池等场景。

---

## 版权声明

```
Copyright (c) 2010-2024 yggdrasil
author: xu yang
MIT License
```

---

如需详细用法，请参考构造函数、成员函数及swap相关实现。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: `database_connection_pool.hpp` 文档

# 文件概述

该头文件定义了 `yggr::database_system::database_connection_pool` 类，实现了数据库连接池的基本功能。该类负责统一管理数据库连接对象的创建、复用、回收与线程安全访问，支持多字符集和分配器，适用于高并发、跨平台的数据库应用场景。

---

## 命名空间

- `yggr::database_system`

---

## 主要类

### `database_connection_pool`

#### 主要成员类型
- `conn_type`：底层数据库连接类型（如 `dtl::DBConnection`）。
- `org_conn_ptr_type`：连接对象的智能指针类型。
- `connection_type`：封装的数据库连接类型。
- `init_type`：连接初始化参数类型（`database_connection_init`）。
- `init_wrap_type`：线程安全的连接初始化参数包装。
- `conn_queue_type`：线程安全的连接队列。

#### 主要成员变量
- `_init_wrap`：线程安全的连接初始化参数。
- `_conn_queue`：线程安全的连接对象队列。

#### 主要接口

- **构造与析构**
  - 支持多字符集DSN、提示、自动提交等参数初始化。
  - 禁止拷贝和移动。

- **连接池操作**
  - `push(const org_conn_ptr_type&)`：回收连接对象到池中（校验DSN和自动提交参数）。
  - `pop()`：从池中获取一个连接对象。
  - `clear()`：清空连接池。
  - `empty()`：判断连接池是否为空。
  - `operator bool()`：判断连接池是否有效。

- **连接信息访问**
  - `gen_connection(connection_type&)`：生成新的连接对象。
  - `dns_string()`/`dns_string(const Alloc&)`/`dns_string(const string&)`：获取DSN字符串，支持多字符集和分配器。
  - `connect_info()`：获取当前连接初始化参数。

---

## 技术要点

- **线程安全**：通过 `safe_wrap` 和 `safe_queue` 实现多线程安全的参数和连接管理。
- **连接复用**：通过队列实现连接对象的复用，减少频繁创建销毁的开销。
- **参数校验**：回收连接时校验DSN和自动提交参数，保证连接池一致性。
- **多字符集支持**：DSN字符串支持多字符集转换，适应国际化需求。
- **分配器兼容**：支持自定义分配器，便于与STL容器集成。

---

## 适用场景

- 需要高并发、线程安全数据库连接复用的服务端或中间件系统。
- 需要支持多字符集、跨平台数据库访问的项目。
- 需要灵活管理数据库连接生命周期和参数的场景。

---

## 版权声明

```
Copyright (c) 2010-2024 yggdrasil
author: xu yang
MIT License
```

---

如需详细用法，请参考构造函数、成员函数及相关类型定义。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: `database_connection.hpp` 文档

# 文件概述

该头文件定义了 `yggr::database_system::database_connection` 类及其内部容器，负责封装和管理单个数据库连接对象的生命周期、线程安全访问、初始化、复用等操作。该类是数据库连接池、数据库访问器等上层组件的基础，支持多字符集、智能指针、线程安全和高效资源管理。

---

## 命名空间

- `yggr::database_system`
- `yggr::database_system::detail`
- `yggr::database_system::swap_support`

---

## 主要类

### 1. `detail::database_connection_container`

- 封装了数据库连接对象（`dtl::DBConnection`）的智能指针和状态。
- 支持拷贝、移动、swap、线程安全访问。
- 提供 `push`/`pop` 机制，实现连接对象的复用与回收。
- 支持通过 handler 方式安全访问底层连接对象。

### 2. `database_connection`

- 封装了线程安全的数据库连接容器（`safe_wrap<database_connection_container>`）。
- 禁止拷贝和移动，保证连接对象唯一性。
- 支持多字符集DSN、提示、自动提交等参数初始化。
- 提供 `push`/`pop`/`init`/`clear` 等接口，便于连接池和访问器统一管理。
- 支持 handler 方式安全访问底层连接对象，便于自定义操作和异常处理。
- 提供唯一ID（指针转整型）用于标识连接对象。
- 提供 swap 支持，便于容器操作和性能优化。

---

## 技术要点

- **线程安全**：通过 `safe_wrap` 实现多线程安全的连接对象管理。
- **资源复用**：`push`/`pop` 机制支持连接对象的高效复用，减少频繁创建销毁的开销。
- **handler访问**：通过 handler 方式安全访问底层连接，便于扩展和自定义操作。
- **多字符集支持**：支持多字符集DSN，适应国际化和多数据库环境。
- **swap友好**：提供标准和boost命名空间下的swap重载。

---

## 适用场景

- 需要高效、线程安全管理数据库连接对象的服务端或中间件系统。
- 需要与连接池、访问器等上层组件协同工作的数据库基础设施。
- 需要支持多字符集、跨平台数据库访问的项目。

---

## 版权声明

```
Copyright (c) 2010-2024 yggdrasil
author: xu yang
MIT License
```

---

如需详细用法，请参考构造函数、成员函数及swap相关实现。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: `database_mgr.hpp` 文档

# 文件概述

该头文件定义了 `yggr::database_system::database_mgr` 模板类，是一个通用的数据库管理器，基于 `dbs_manager::dbs_mgr` 实现。它支持多种数据库连接类型、访问器、用户自定义数据，适用于需要统一管理数据库连接、命令注册与调度的高性能场景。

---

## 命名空间

- `yggr::database_system`

---

## 主要模板类

### `database_mgr`

#### 模板参数
- `Key`：数据库连接的键类型（如标识符、名称等）。
- `Conn`：数据库连接类型。
- `Accesser`：数据库访问器类型，默认为 `database_accesser`。
- `InUserData`：输入用户数据类型，默认为 `yggr::any`。
- `OutUserData`：输出用户数据类型，默认为 `yggr::any`。

#### 继承关系
- 继承自 `dbs_manager::dbs_mgr`，复用其数据库管理能力。

#### 主要成员类型
- `key_type`、`conn_type`、`init_type`、`accesser_type`、`in_user_data_type`、`out_user_data_type`：类型适配。

#### 构造与析构
- 支持 C++11 可变参数模板构造（或预处理器宏展开的多参数构造），可灵活传递初始化参数。
- 支持通过 `init_type` 直接初始化。
- 析构函数默认。

#### 主要接口（继承自基类）
- `register_command`：注册数据库命令。
- `unregister_command`：注销数据库命令。
- `execute`：执行数据库操作。
- `reconnect`：重连数据库。
- `clear`：清理所有资源。

---

## 技术要点

- **统一管理**：支持多种数据库连接、访问器和用户数据类型，便于统一管理和扩展。
- **命令注册与调度**：支持数据库命令的注册、注销和调度，适合复杂业务逻辑。
- **高兼容性**：通过模板和可变参数，适应不同数据库和业务场景。
- **与上层集成**：可作为数据库访问、调度、异步管理等上层组件的基础。

---

## 适用场景

- 需要统一管理多种数据库连接、支持多种数据类型和自定义访问逻辑的复杂系统。
- 需要事件驱动、命令注册与调度的数据库应用。

---

## 版权声明

```
Copyright (c) 2010-2024 yggdrasil
author: xu yang
MIT License
```

---

如需详细接口用法或示例，请参考基类 `dbs_mgr` 及相关文档。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: `database_string_helper.hpp` 文档

# 文件概述

该头文件定义了 `yggr::database_system::database_string_helper` 工具类，主要用于数据库相关字符串的字符集转换。该类为数据库操作中各种字符串类型（如C风格字符串、标准字符串、utf8_string等）与数据库内部字符串类型之间的转换提供统一接口，保证字符集兼容性和类型安全。

---

## 命名空间

- `yggr::database_system`

---

## 主要类

### `database_string_helper`

#### 主要类型定义
- `org_string_type`：数据库内部字符串类型（如 `dtl::tstring`）。
- `inner_string_type`：内部utf8字符串类型。

#### 主要静态方法

- `s_conv(const Char* str, const string& charset_name)`
  - 将C风格字符串按指定字符集转换为数据库内部字符串类型。
  - 默认字符集由类型自动推导。

- `s_conv(const Basic_String<Char, Traits, Alloc>& str, const string& charset_name)`
  - 将标准字符串（如 `std::string`、`std::wstring`）按指定字符集转换为数据库内部字符串类型。
  - 支持自定义分配器和traits。

- `s_conv(const charset::utf8_string_impl<Char, Traits, Alloc>& str, const string& charset_name)`
  - 将 `utf8_string` 类型转换为数据库内部字符串类型。
  - 断言字符集为utf8。

- `s_conv(const charset::string_charset_helper<T1, T2>& src)`
  - 通过 `string_charset_helper` 辅助类型进行转换，适配多种字符串源。

---

## 技术要点

- **字符集兼容**：自动处理不同字符集之间的转换，保证数据库操作的兼容性和正确性。
- **类型安全**：通过SFINAE和类型萃取，确保只有合适的类型才能调用相关接口。
- **多样性支持**：支持C风格字符串、标准字符串、utf8_string等多种常见字符串类型。

---

## 适用场景

- 需要在数据库操作中统一处理多种字符串类型和字符集的项目。
- 需要保证数据库操作字符集兼容性和类型安全的中间件、ORM等系统。

---

## 版权声明

```
Copyright (c) 2010-2024 yggdrasil
author: xu yang
MIT License
```

---

如需详细用法，请参考各静态方法定义及相关类型说明。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: `dtl_error.hpp` 文档

# 文件概述

该头文件定义了数据库系统相关的错误码常量和错误类型，主要用于统一管理数据库操作中的异常和错误处理。通过封装错误码和类型，便于在数据库访问、异常捕获、日志等场景下进行一致性处理。

---

## 命名空间

- `yggr::database_system`

---

## 主要内容

### 1. 结构体 `dtl_error_code_def`

- 定义了数据库相关的错误码常量：
  - `E_DTL_DB_ERR_CODE`：数据库操作错误码（对应 `exception::exception_sort::E_code_dtl_db_error`）。
  - `E_DTL_ROOT_ERR_CODE`：数据库根错误码（对应 `exception::exception_sort::E_code_dtl_root_error`）。

### 2. 类型定义

- `dtl_error`：数据库错误类型，实质为 `yggr::error`，用于统一表示和传递错误信息。

---

## 技术要点

- **统一错误码**：通过静态常量集中管理数据库相关错误码，便于维护和扩展。
- **类型兼容**：直接复用 `yggr::error` 类型，便于与框架其他模块协同工作。
- **异常分级**：区分普通数据库错误和根错误，便于精细化异常处理。

---

## 适用场景

- 需要在数据库操作、异常捕获、日志记录等场景下统一处理错误码和错误信息的项目。
- 需要与 yggr 框架其他异常处理机制集成的系统。

---

## 版权声明

```
Copyright (c) 2010-2024 yggdrasil
author: xu yang
MIT License
```

---

如需详细用法，请参考错误码常量和 `dtl_error` 类型的具体用法。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: `dtl_include_helper.hpp` 文档

# 文件概述

该头文件作为数据库系统的 DTL（Database Template Library）相关头文件的统一包含入口，主要用于解决平台兼容性问题并集中管理 DTL 相关依赖。通过该文件，项目可方便地引入 DTL 及其相关配置，避免重复包含和平台冲突。

---

## 主要内容

- 包含 yggrdef.h：基础类型和宏定义。
- 包含 socket_conflict_fixer.hpp：用于修复网络相关的头文件冲突，保证 DTL 在不同平台下的兼容性。
- 包含 `<DTL.h>`：引入 DTL（Database Template Library）主头文件，提供数据库模板操作能力。

---

## 技术要点

- **平台兼容性**：通过 `socket_conflict_fixer.hpp` 解决 DTL 与网络头文件的冲突，提升跨平台兼容性。
- **集中管理**：统一 DTL 相关头文件的包含，便于维护和升级。
- **简化依赖**：上层模块只需包含本文件即可获得 DTL 相关功能，无需关心底层依赖细节。

---

## 适用场景

- 需要在项目中统一引入 DTL 及其相关依赖的场景。
- 需要解决 DTL 与网络头文件冲突、提升跨平台兼容性的项目。

---

## 版权声明

```
Copyright (c) 2010-2024 yggdrasil
author: xu yang
MIT License
```

---

如需详细用法，请参考 DTL 官方文档及本文件包含的相关头文件。

alucard-dracula: 为这个文件生成文档

GitHub Copilot: `dtl_installer.hpp` 文档

# 文件概述

该头文件定义了 `yggr::database_system::dtl_installer` 工具类，用于管理 DTL（Database Template Library）全局环境和连接的初始化与释放。该类为数据库系统提供了统一的 DTL 安装与卸载接口，便于资源管理和生命周期控制。

---

## 命名空间

- `yggr::database_system`

---

## 主要类

### `dtl_installer`

- 禁止创建实例（继承自 `nonable::noncreateable`）。
- 仅提供静态方法。

#### 主要静态方法

- `install()`  
  DTL 安装入口。当前为空实现，预留扩展。

- `uninstall()`  
  DTL 卸载入口。释放 DTL 全局默认连接和环境，防止资源泄漏。

---

## 技术要点

- **全局资源管理**：通过静态方法统一管理 DTL 全局资源的初始化与释放。
- **安全性**：`uninstall()` 确保 DTL 全局连接和环境被正确释放，避免内存泄漏。
- **扩展性**：`install()` 方法预留，便于后续扩展 DTL 初始化逻辑。

---

## 适用场景

- 需要在应用程序启动和关闭时统一管理 DTL 全局资源的项目。
- 需要防止 DTL 相关资源泄漏、提升系统健壮性的数据库应用。

---

## 版权声明

```
Copyright (c) 2010-2024 yggdrasil
author: xu yang
MIT License
```

---

如需详细用法，请参考 `install()` 和 `uninstall()` 静态方法的调用方式。